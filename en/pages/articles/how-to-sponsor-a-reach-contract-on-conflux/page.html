<p>This article shows you how to pay the gas and storage fees on behalf of participants that visit a Reach smart contract deployed on the Conflux MainNet or TestNet. You do this by adding the Reach contract information to the Conflux internal <em>SponsorControl</em> contract. For more information about Conflux internal contracts, see the <a href="https://developer.confluxnetwork.org/conflux-rust/internal_contract/internal_contract/">Internal Contract</a> page on the <a href="https://developer.confluxnetwork.org/">Conflux Developer Portal</a>.</p>
<ol>
  <li>
    <p>Open the JavaScript file (e.g. <em>index.js</em> or <em>index.mjs</em>) associated with your webapp.</p>
  </li>
  <li>
    <p>Add the follow lines after your existing imports:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> {</span><span style="color: #005CC5">Conflux</span><span style="color: #24292E">} </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">require</span><span style="color: #24292E">(</span><span style="color: #032F62">'js-conflux-sdk'</span><span style="color: #24292E">);</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">cfx</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Conflux</span><span style="color: #24292E">({</span></li><li value="3"><span style="color: #24292E">  url: </span><span style="color: #032F62">'https://test.confluxrpc.com'</span><span style="color: #24292E">,</span></li><li value="4"><span style="color: #24292E">  logger: console,</span></li><li value="5"><span style="color: #24292E">  networkId: </span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span></li><li value="6"><span style="color: #24292E">});</span></li><li value="7"><span style="color: #24292E">cfx.provider </span><span style="color: #D73A49">=</span><span style="color: #24292E"> window.conflux;</span></li></ol></pre>
    <ul>
      <li>Line 1: Import the <a href="https://github.com/Conflux-Chain/js-conflux-sdk">Conflux JavaScript Library</a>.</li>
      <li>Line 2: Instantiate a Conflux object.</li>
      <li>Line 7: Set <code>provider</code> to the <a href="https://portal.confluxnetwork.org/">ConfluxPortal</a> user's address.</li>
    </ul>
  </li>
  <li>
    <p>Add the following lines after a participant deploys the Reach contract (within an <code>async</code> scope):</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sponsor_contract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> cfx.</span><span style="color: #6F42C1">InternalContract</span><span style="color: #24292E">(</span><span style="color: #032F62">'SponsorWhitelistControl'</span><span style="color: #24292E">);</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">ctcInfo</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> ctc.</span><span style="color: #6F42C1">getContractAddress</span><span style="color: #24292E">();</span></li><li value="3"><span style="color: #D73A49">await</span><span style="color: #24292E"> sponsor_contract.</span><span style="color: #6F42C1">addPrivilegeByAdmin</span><span style="color: #24292E">(ctcInfo, [</span><span style="color: #032F62">"0x0000000000000000000000000000000000000000"</span><span style="color: #24292E">])</span></li><li value="4"><span style="color: #24292E">  .</span><span style="color: #6F42C1">sendTransaction</span><span style="color: #24292E">({from: reach.</span><span style="color: #6F42C1">formatAddress</span><span style="color: #24292E">(</span><span style="color: #005CC5">this</span><span style="color: #24292E">.props.acc),</span></li><li value="5"><span style="color: #24292E">});</span></li></ol></pre>
    <ul>
      <li>Line 1: Get a reference to the Conflux internal <em>SponsorWhitelistControl</em> contract.</li>
      <li>Line 2: Get the contract information of your Reach contract.</li>
      <li>Line 3: Sponsor all addresses in the array (or, in this case, all addresses).</li>
      <li>Line 4: Send a transaction signed by ConfluxPortal. <code>addPrivilegeByAdmin</code> returns the address of the initiator.</li>
    </ul>
  </li>
</ol>
<p>Below is an example from <a href="https://github.com/reach-sh/reach-lang/tree/master/examples/tut-9">Tutorial 9</a>:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #24292E">async </span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">() {</span></li><li value="2"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">ctc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">.props.acc.</span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">(backend);</span></li><li value="3"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">.</span><span style="color: #6F42C1">setState</span><span style="color: #24292E">({view: </span><span style="color: #032F62">'Deploying'</span><span style="color: #24292E">, ctc});</span></li><li value="4"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">.wager </span><span style="color: #D73A49">=</span><span style="color: #24292E"> reach.</span><span style="color: #6F42C1">parseCurrency</span><span style="color: #24292E">(</span><span style="color: #005CC5">this</span><span style="color: #24292E">.state.wager); </span></li><li value="5"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">.deadline </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {ETH: </span><span style="color: #005CC5">10</span><span style="color: #24292E">, ALGO: </span><span style="color: #005CC5">100</span><span style="color: #24292E">, CFX: </span><span style="color: #005CC5">1000</span><span style="color: #24292E">}[reach.connector]; </span></li><li value="6"><span style="color: #24292E">    backend.</span><span style="color: #6F42C1">Alice</span><span style="color: #24292E">(ctc, </span><span style="color: #005CC5">this</span><span style="color: #24292E">);</span></li><li value="7"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sponsor_contract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> cfx.</span><span style="color: #6F42C1">InternalContract</span><span style="color: #24292E">(</span><span style="color: #032F62">'SponsorWhitelistControl'</span><span style="color: #24292E">);</span></li><li value="8"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">ctcInfo</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> ctc.</span><span style="color: #6F42C1">getContractAddress</span><span style="color: #24292E">();</span></li><li value="9"><span style="color: #24292E">    </span><span style="color: #D73A49">await</span><span style="color: #24292E"> sponsor_contract.</span><span style="color: #6F42C1">addPrivilegeByAdmin</span><span style="color: #24292E">(ctcInfo, [</span><span style="color: #032F62">"0x0000000000000000000000000000000000000000"</span><span style="color: #24292E">]).</span><span style="color: #6F42C1">sendTransaction</span><span style="color: #24292E">({</span></li><li value="10"><span style="color: #24292E">      from: reach.</span><span style="color: #6F42C1">formatAddress</span><span style="color: #24292E">(</span><span style="color: #005CC5">this</span><span style="color: #24292E">.props.acc),</span></li><li value="11"><span style="color: #24292E">    });</span></li><li value="12"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">ctcInfoStr</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">JSON</span><span style="color: #24292E">.</span><span style="color: #005CC5">stringify</span><span style="color: #24292E">(</span><span style="color: #D73A49">await</span><span style="color: #24292E"> ctc.</span><span style="color: #6F42C1">getInfo</span><span style="color: #24292E">(), </span><span style="color: #005CC5">null</span><span style="color: #24292E">, </span><span style="color: #005CC5">2</span><span style="color: #24292E">);</span></li><li value="13"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">.</span><span style="color: #6F42C1">setState</span><span style="color: #24292E">({view: </span><span style="color: #032F62">'WaitingForAttacher'</span><span style="color: #24292E">, ctcInfoStr});</span></li><li value="14"><span style="color: #24292E">  }</span></li></ol></pre>