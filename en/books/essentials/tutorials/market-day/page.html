<p><span style="color:red;">Under Construction</span></p>
<p>This tutorial builds upon <a href="/en/books/essentials/tutorials/wisdom-for-sale/">Wisdom for Sale</a> by demonstrating how to use a variety of data types (string, integer, boolean, object, and array) in interact objects. You should complete <a href="/en/books/essentials/tutorials/wisdom-for-sale/">Wisdom for Sale</a> before continuing.</p>
<p>The tutorial shows you how to build <a href="https://github.com/hagenhaus/market-day">Market Day</a>, a command-line and web-based application that enables two participants, a seller and a buyer, to trade vegetables for tokens via a smart contract running on a private Algorand, Ethereum, or Conflux consensus network residing in a Docker container on your computer. Your DApp creates and funds two accounts (one for each participant), enables the seller and buyer to make a transaction, and exits.</p>
<p>The contract in this tutorial supports a single transaction between a seller and a buyer. Other tutorials present contracts that support transactions between a seller and multiple buyers.</p>
<h1 id="learning-objectives">Learning Objectives</h1>
<p>The following learning objectives describe what you will be able to do as a result of completing this tutorial.</p>
<ol>
  <li>sss</li>
  <li>sss</li>
  <li>sss</li>
</ol>
<h1 id="examine-the-transaction">Examine the transaction</h1>
<p>The following diagram represents a market-day transaction:</p>
<div>
  <img src="/en/books/essentials/tutorials/market-day/seller-buyer.png" class="img-fluid my-4 d-block" width="850" height="463" loading="lazy">
</div>
<p>The contract automatically supplies a product list to the buyer who chooses a product type, chooses a quantity, and confirms the purchase. Once the buyer completes or cancels the purchase, the contract exits.</p>
<h1 id="clone-and-run">Clone and run</h1>
<p>This section shows you how to clone the tutorial repository.</p>
<ol>
  <li>
    <p>Clone the <a href="https://github.com/hagenhaus/market-day">market-day</a> repository:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ cd ~/reach</li><li value="2">$ git clone https://github.com/hagenhaus/market-day.git</li></ol></pre>
  </li>
  <li>
    <p>Open the repository in vscode, and change directory to <em>current</em>.</p>
    <p>
      <img src="/en/books/essentials/tutorials/market-day/vscode-initial.png" class="img-fluid" width="700" loading="lazy">
    </p>
  </li>
  <li>
    <p>Copy <em>index.mjs</em> and <em>index.rsh</em> from the <em>starter</em> folder to the <em>current</em> folder.</p>
    <p>
      <img src="/en/books/essentials/tutorials/market-day/vscode-open.png" class="img-fluid" width="700" loading="lazy">
    </p>
  </li>
  <li>
    <p>Open two terminals (i.e. shells):</p>
    <p>
      <img src="/en/books/essentials/tutorials/market-day/terminals-empty.png" class="img-fluid" width="700" loading="lazy">
    </p>
  </li>
  <li>
    <p>Change directory in both terminals:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ ~/reach/market-day/current</li></ol></pre>
  </li>
  <li>
    <p>Run the following command in both terminals:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ export REACH_CONNECTOR_MODE=ALGO-devnet</li></ol></pre>
  </li>
  <li>
    <p>In the Seller Terminal, run your DApp as the seller:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ reach run index seller</li></ol></pre>
  </li>
  <li>
    <p>In the Buyer Terminal, run your DApp as the buyer:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ reach run index buyer</li></ol></pre>
  </li>
  <li>
    <p>When prompted, copy &amp; paste the contract info from the Seller Terminal to the Buyer Terminal. Final output should resemble the following:</p>
    <div class="row gx-3">
      <div class="col-12 col-lg-auto">
        <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is seller.</li><li value="2">The consensus network is ALGO.</li><li value="3">Your balance is 1000 ALGO.</li><li value="4">Contract info: 259</li><li value="5">Exiting contract.</li><li value="6">Your balance is 999.997 ALGO.</li></ol></pre>
      </div>
      <div class="col-12 col-lg-auto">
        <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is buyer.</li><li value="2">The consensus network is ALGO.</li><li value="3">Paste contract info:</li><li value="4">259</li><li value="5">Your balance is 1000 ALGO.</li><li value="6">Exiting contract.</li><li value="7">Your balance is 999.998 ALGO.</li></ol></pre>
      </div>
    </div>
  </li>
  <li>
    <p>Repeat Steps 6-9 for <em>CFX-devnet</em> and <em>ETH-devnet</em>.</p>
  </li>
</ol>
<h1 id="examine-dapp-design">Examine DApp design</h1>
<p>The starter files for this tutorial may seem, at first glance, more complex than the starter files for the Wisdom for Sale tutorial. But, upon closer inspection, you will notice that they consist of boilerplate code useful for starting any Reach command-line DApp. Together, a Reach DApp frontend (index.mjs) and backend (index.rsh) reflect, roughly, the organization illustrated in the diagram below:</p>
<div>
  <img src="/en/books/essentials/tutorials/market-day/design.png" class="img-fluid my-4 d-block" width="900" height="475" loading="lazy">
</div>
<p>Note the following:</p>
<ul>
  <li>There is a one-to-one correspondence between the frontend and backend interact objects.</li>
  <li>This correspondence includes most interact properties and methods.</li>
  <li>The seller calls <code>backend.Seller</code> to pass the interact object to the backend.</li>
  <li>The buyer calls <code>contract.participant.Buyer</code> to do the same.</li>
  <li>The seller and buyer sections often include methods that return promises, so async/await is needed.</li>
</ul>
<h2 id="review-frontend-starter">Review frontend starter</h2>
<p>This section helps you map the frontend portion of the diagram to the code in <em>index.mjs</em>.</p>
<div>
  <img src="/en/books/essentials/tutorials/market-day/design-fe.png" class="img-fluid my-4 d-block" width="900" height="475" loading="lazy">
</div>
<p>This table maps the diagram to the code below:</p>
<table>
  <thead>
    <tr>
      <th>Diagram</th>
      <th>Code</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>imports</td>
      <td>Lines 1-3</td>
    </tr>
    <tr>
      <td>definitions</td>
      <td>Lines 9-19</td>
    </tr>
    <tr>
      <td>commonInteract</td>
      <td>Lines 23-25</td>
    </tr>
    <tr>
      <td>seller and sellerInteract</td>
      <td>Lines 28-39</td>
    </tr>
    <tr>
      <td>buyer and buyerInteract</td>
      <td>Lines 42-53</td>
    </tr>
  </tbody>
</table>
<h3 id="indexmjs">index.mjs</h3>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">import</span><span style="color: #24292E"> { loadStdlib } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'@reach-sh/stdlib'</span><span style="color: #24292E">;</span></li><li value="2"><span style="color: #D73A49">import</span><span style="color: #24292E"> </span><span style="color: #005CC5">*</span><span style="color: #24292E"> </span><span style="color: #D73A49">as</span><span style="color: #24292E"> backend </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'./build/index.main.mjs'</span><span style="color: #24292E">;</span></li><li value="3"><span style="color: #D73A49">import</span><span style="color: #24292E"> { ask, yesno, done } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'@reach-sh/stdlib/ask.mjs'</span><span style="color: #24292E">;</span></li><li value="4"></li><li value="5"><span style="color: #D73A49">if</span><span style="color: #24292E"> (process.argv.</span><span style="color: #005CC5">length</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E"> </span><span style="color: #D73A49">||</span><span style="color: #24292E"> [</span><span style="color: #032F62">'seller'</span><span style="color: #24292E">, </span><span style="color: #032F62">'buyer'</span><span style="color: #24292E">].</span><span style="color: #6F42C1">includes</span><span style="color: #24292E">(process.argv[</span><span style="color: #005CC5">2</span><span style="color: #24292E">]) </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">) {</span></li><li value="6"><span style="color: #24292E">  console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">'Usage: reach run index [seller|buyer]'</span><span style="color: #24292E">);</span></li><li value="7"><span style="color: #24292E">  process.</span><span style="color: #6F42C1">exit</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></li><li value="8"><span style="color: #24292E">}</span></li><li value="9"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">role</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> process.argv[</span><span style="color: #005CC5">2</span><span style="color: #24292E">];</span></li><li value="10"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Your role is ${</span><span style="color: #24292E">role</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li><li value="11"></li><li value="12"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">stdlib</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">loadStdlib</span><span style="color: #24292E">(process.env);</span></li><li value="13"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`The consensus network is ${</span><span style="color: #24292E">stdlib</span><span style="color: #032F62">.</span><span style="color: #24292E">connector</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li><li value="14"></li><li value="15"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">suStr</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> stdlib.standardUnit;</span></li><li value="16"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #E36209">su</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">parseCurrency</span><span style="color: #24292E">(su);</span></li><li value="17"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toSU</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #E36209">au</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">formatCurrency</span><span style="color: #24292E">(au, </span><span style="color: #005CC5">4</span><span style="color: #24292E">);</span></li><li value="18"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">iBalance</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E">(</span><span style="color: #005CC5">1000</span><span style="color: #24292E">);</span></li><li value="19"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">async</span><span style="color: #24292E"> (</span><span style="color: #E36209">acc</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Your balance is ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #D73A49">await</span><span style="color: #032F62"> </span><span style="color: #24292E">stdlib</span><span style="color: #032F62">.</span><span style="color: #6F42C1">balanceOf</span><span style="color: #032F62">(</span><span style="color: #24292E">acc</span><span style="color: #032F62">))</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li><li value="20"></li><li value="21"><span style="color: #24292E">(</span><span style="color: #D73A49">async</span><span style="color: #24292E"> () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="22"></li><li value="23"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">commonInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #E36209">role</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> ({</span></li><li value="24"><span style="color: #24292E">    </span><span style="color: #6F42C1">reportExit</span><span style="color: #24292E">: () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Exiting contract.`</span><span style="color: #24292E">)</span></li><li value="25"><span style="color: #24292E">  });</span></li><li value="26"></li><li value="27"><span style="color: #24292E">  </span><span style="color: #6A737D">// SELLER</span></li><li value="28"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (role </span><span style="color: #D73A49">===</span><span style="color: #24292E"> </span><span style="color: #032F62">'seller'</span><span style="color: #24292E">) {</span></li><li value="29"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sellerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="30"><span style="color: #24292E">      </span><span style="color: #D73A49">...</span><span style="color: #6F42C1">commonInteract</span><span style="color: #24292E">(role),</span></li><li value="31"><span style="color: #24292E">      </span><span style="color: #6F42C1">reportReady</span><span style="color: #24292E">: </span><span style="color: #D73A49">async</span><span style="color: #24292E"> () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Contract info: ${</span><span style="color: #005CC5">JSON</span><span style="color: #032F62">.</span><span style="color: #005CC5">stringify</span><span style="color: #032F62">(</span><span style="color: #D73A49">await</span><span style="color: #032F62"> </span><span style="color: #24292E">ctc</span><span style="color: #032F62">.</span><span style="color: #6F42C1">getInfo</span><span style="color: #032F62">())</span><span style="color: #032F62">}`</span><span style="color: #24292E">); }</span></li><li value="32"><span style="color: #24292E">    };</span></li><li value="33"></li><li value="34"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">acc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">newTestAccount</span><span style="color: #24292E">(iBalance);</span></li><li value="35"><span style="color: #24292E">    </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E">(acc);</span></li><li value="36"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">ctc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> acc.</span><span style="color: #6F42C1">contract</span><span style="color: #24292E">(backend);</span></li><li value="37"><span style="color: #24292E">    </span><span style="color: #D73A49">await</span><span style="color: #24292E"> backend.</span><span style="color: #6F42C1">Seller</span><span style="color: #24292E">(ctc, sellerInteract);</span></li><li value="38"><span style="color: #24292E">    </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E">(acc);</span></li><li value="39"><span style="color: #24292E">  }</span></li><li value="40"></li><li value="41"><span style="color: #24292E">  </span><span style="color: #6A737D">// BUYER</span></li><li value="42"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></li><li value="43"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">buyerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="44"><span style="color: #24292E">      </span><span style="color: #D73A49">...</span><span style="color: #6F42C1">commonInteract</span><span style="color: #24292E">(role) </span></li><li value="45"><span style="color: #24292E">    };</span></li><li value="46"></li><li value="47"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">acc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">newTestAccount</span><span style="color: #24292E">(iBalance);</span></li><li value="48"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">info</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(</span><span style="color: #032F62">'Paste contract info:'</span><span style="color: #24292E">, (</span><span style="color: #E36209">s</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">JSON</span><span style="color: #24292E">.</span><span style="color: #005CC5">parse</span><span style="color: #24292E">(s));</span></li><li value="49"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">ctc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> acc.</span><span style="color: #6F42C1">contract</span><span style="color: #24292E">(backend, info);</span></li><li value="50"><span style="color: #24292E">    </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E">(acc);</span></li><li value="51"><span style="color: #24292E">    </span><span style="color: #D73A49">await</span><span style="color: #24292E"> ctc.p.</span><span style="color: #6F42C1">Buyer</span><span style="color: #24292E">(buyerInteract);</span></li><li value="52"><span style="color: #24292E">    </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E">(acc);</span></li><li value="53"><span style="color: #24292E">  }</span></li><li value="54"></li><li value="55"><span style="color: #24292E">  </span><span style="color: #6F42C1">done</span><span style="color: #24292E">();</span></li><li value="56"><span style="color: #24292E">})();</span></li></ol></pre>
<h2 id="review-backend-starter">Review backend starter</h2>
<p>This section helps you map the backend portion of the diagram to the code in <em>index.rsh</em>.</p>
<div>
  <img src="/en/books/essentials/tutorials/market-day/design-be.png" class="img-fluid my-4 d-block" width="900" height="475" loading="lazy">
</div>
<p>This table maps the diagram to the code below:</p>
<table>
  <thead>
    <tr>
      <th>Diagram</th>
      <th>Code</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>commonInteract</td>
      <td>Lines 3-5</td>
    </tr>
    <tr>
      <td>sellerInteract</td>
      <td>Lines 7-10</td>
    </tr>
    <tr>
      <td>buyerInteract</td>
      <td>Lines 12-14</td>
    </tr>
    <tr>
      <td>Participant definitions</td>
      <td>Lines 16-18</td>
    </tr>
    <tr>
      <td>Init mode to Step mode transition</td>
      <td>Line 17</td>
    </tr>
    <tr>
      <td>Participant interactions</td>
      <td>Lines 21-28</td>
    </tr>
  </tbody>
</table>
<h3 id="indexrsh">index.rsh</h3>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #032F62">'reach 0.1'</span><span style="color: #24292E">;</span></li><li value="2"></li><li value="3"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">commonInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="4"><span style="color: #24292E">  reportExit: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([], Null)</span></li><li value="5"><span style="color: #24292E">};</span></li><li value="6"></li><li value="7"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sellerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="8"><span style="color: #24292E">  </span><span style="color: #D73A49">...</span><span style="color: #24292E">commonInteract,</span></li><li value="9"><span style="color: #24292E">  reportReady: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([], Null)</span></li><li value="10"><span style="color: #24292E">};</span></li><li value="11"></li><li value="12"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">buyerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="13"><span style="color: #24292E">  </span><span style="color: #D73A49">...</span><span style="color: #24292E">commonInteract</span></li><li value="14"><span style="color: #24292E">};</span></li><li value="15"></li><li value="16"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">main</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Reach.</span><span style="color: #6F42C1">App</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="17"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">S</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Seller'</span><span style="color: #24292E">, sellerInteract);</span></li><li value="18"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">B</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Buyer'</span><span style="color: #24292E">, buyerInteract);</span></li><li value="19"><span style="color: #24292E">  </span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">();</span></li><li value="20"></li><li value="21"><span style="color: #24292E">  </span><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">();</span></li><li value="22"><span style="color: #24292E">  </span><span style="color: #005CC5">S</span><span style="color: #24292E">.interact.</span><span style="color: #6F42C1">reportReady</span><span style="color: #24292E">();</span></li><li value="23"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="24"></li><li value="25"><span style="color: #24292E">  </span><span style="color: #005CC5">B</span><span style="color: #24292E">.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">();</span></li><li value="26"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="27"></li><li value="28"><span style="color: #24292E">  </span><span style="color: #6F42C1">each</span><span style="color: #24292E">([</span><span style="color: #005CC5">S</span><span style="color: #24292E">, </span><span style="color: #005CC5">B</span><span style="color: #24292E">], () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> interact.</span><span style="color: #6F42C1">reportExit</span><span style="color: #24292E">());</span></li><li value="29"><span style="color: #24292E">  </span><span style="color: #6F42C1">exit</span><span style="color: #24292E">();</span></li><li value="30"><span style="color: #24292E">});</span></li></ol></pre>
<h1 id="add-products-to-contract-seller">Add products to contract (seller)</h1>
<p>This section shows you how to do the following:</p>
<ol>
  <li>Implement seller code that adds a product list to the contract.</li>
  <li>Implement contract code that passes the product list to the buyer.</li>
  <li>Implement buyer code that displays the list.</li>
</ol>
<p>The seller offers potatoes at 200 <strong>standard units</strong> per bag, carrots at 100 su per bunch, and corn at 50 su per ear:</p>
<div>
  <img src="/en/books/essentials/tutorials/market-day/products.png" class="img-fluid my-4 d-block" width="400" height="146" loading="lazy">
</div>
<p>The <code>products</code> object reflects this information:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">products</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span></li><li value="2"><span style="color: #24292E">  { name: </span><span style="color: #032F62">'Potatoes'</span><span style="color: #24292E">, unit: </span><span style="color: #032F62">'bag'</span><span style="color: #24292E">, units: </span><span style="color: #032F62">'bags'</span><span style="color: #24292E">, price: </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E">(</span><span style="color: #005CC5">200</span><span style="color: #24292E">) },</span></li><li value="3"><span style="color: #24292E">  { name: </span><span style="color: #032F62">'Carrots'</span><span style="color: #24292E">, unit: </span><span style="color: #032F62">'bunch'</span><span style="color: #24292E">, units: </span><span style="color: #032F62">'bunches'</span><span style="color: #24292E">, price: </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E">(</span><span style="color: #005CC5">100</span><span style="color: #24292E">) },</span></li><li value="4"><span style="color: #24292E">  { name: </span><span style="color: #032F62">'Corn'</span><span style="color: #24292E">, unit: </span><span style="color: #032F62">'ear'</span><span style="color: #24292E">, units: </span><span style="color: #032F62">'ears'</span><span style="color: #24292E">, price: </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E">(</span><span style="color: #005CC5">50</span><span style="color: #24292E">) }</span></li><li value="5"><span style="color: #24292E">];</span></li></ol></pre>
<p>The seller also provides an announcement:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">announcement</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">'List of products for sale:'</span><span style="color: #24292E">;</span></li></ol></pre>
<p>We can bundle <code>announcement</code> and <code>products</code> into a <code>sellerInfo</code> object:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sellerInfo</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  announcement: </span><span style="color: #032F62">'List of products for sale:'</span><span style="color: #24292E">,</span></li><li value="3"><span style="color: #24292E">  products: [</span></li><li value="4"><span style="color: #24292E">    { name: </span><span style="color: #032F62">'Potatoes'</span><span style="color: #24292E">, unit: </span><span style="color: #032F62">'bag'</span><span style="color: #24292E">, units: </span><span style="color: #032F62">'bags'</span><span style="color: #24292E">, price: </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E">(</span><span style="color: #005CC5">200</span><span style="color: #24292E">) },</span></li><li value="5"><span style="color: #24292E">    { name: </span><span style="color: #032F62">'Carrots'</span><span style="color: #24292E">, unit: </span><span style="color: #032F62">'bunch'</span><span style="color: #24292E">, units: </span><span style="color: #032F62">'bunches'</span><span style="color: #24292E">, price: </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E">(</span><span style="color: #005CC5">100</span><span style="color: #24292E">) },</span></li><li value="6"><span style="color: #24292E">    { name: </span><span style="color: #032F62">'Corn'</span><span style="color: #24292E">, unit: </span><span style="color: #032F62">'ear'</span><span style="color: #24292E">, units: </span><span style="color: #032F62">'ears'</span><span style="color: #24292E">, price: </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E">(</span><span style="color: #005CC5">50</span><span style="color: #24292E">) }</span></li><li value="7"><span style="color: #24292E">  ]</span></li><li value="8"><span style="color: #24292E">};</span></li></ol></pre>
<p>The following are directions to add code that passes <code>sellerInfo</code> from seller to buyer via the contract:</p>
<ol>
  <li>
    <p>In <em>index.mjs</em>, add a <code>sellerInfo</code> property to <code>sellerInteract</code>:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #E36209">sellerInfo</span><span style="color: #24292E">: {</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #E36209">announcement</span><span style="color: #24292E">: </span><span style="color: #032F62">'List of products for sale:'</span><span style="color: #24292E">,</span></li><li value="3"><span style="color: #24292E">  </span><span style="color: #E36209">products</span><span style="color: #24292E">: [</span></li><li value="4"><span style="color: #24292E">    { name: </span><span style="color: #032F62">'Potatoes'</span><span style="color: #24292E">, unit: </span><span style="color: #032F62">'bag'</span><span style="color: #24292E">, units: </span><span style="color: #032F62">'bags'</span><span style="color: #24292E">, price: </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E">(</span><span style="color: #005CC5">200</span><span style="color: #24292E">) },</span></li><li value="5"><span style="color: #24292E">    { name: </span><span style="color: #032F62">'Carrots'</span><span style="color: #24292E">, unit: </span><span style="color: #032F62">'bunch'</span><span style="color: #24292E">, units: </span><span style="color: #032F62">'bunches'</span><span style="color: #24292E">, price: </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E">(</span><span style="color: #005CC5">100</span><span style="color: #24292E">) },</span></li><li value="6"><span style="color: #24292E">    { name: </span><span style="color: #032F62">'Corn'</span><span style="color: #24292E">, unit: </span><span style="color: #032F62">'ear'</span><span style="color: #24292E">, units: </span><span style="color: #032F62">'ears'</span><span style="color: #24292E">, price: </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E">(</span><span style="color: #005CC5">50</span><span style="color: #24292E">) }</span></li><li value="7"><span style="color: #24292E">  ]</span></li><li value="8"><span style="color: #24292E">}</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.mjs</em>, add a <code>shop</code> method to <code>buyerInteract</code>:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #E36209">shop</span><span style="color: #24292E">: </span><span style="color: #D73A49">async</span><span style="color: #24292E"> (</span><span style="color: #E36209">sellerInfo</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(sellerInfo.announcement);</span></li><li value="3"><span style="color: #24292E">  sellerInfo.products.</span><span style="color: #6F42C1">forEach</span><span style="color: #24292E">((</span><span style="color: #E36209">p</span><span style="color: #24292E">, </span><span style="color: #E36209">i</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="4"><span style="color: #24292E">    console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`${</span><span style="color: #24292E">i</span><span style="color: #032F62"> </span><span style="color: #D73A49">+</span><span style="color: #032F62"> </span><span style="color: #005CC5">1</span><span style="color: #032F62">}. ${</span><span style="color: #24292E">p</span><span style="color: #032F62">.</span><span style="color: #24292E">name</span><span style="color: #032F62">} at ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #24292E">p</span><span style="color: #032F62">.</span><span style="color: #24292E">price</span><span style="color: #032F62">)</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">} per unit (${</span><span style="color: #24292E">p</span><span style="color: #032F62">.</span><span style="color: #24292E">unit</span><span style="color: #032F62">}).`</span><span style="color: #24292E">);</span></li><li value="5"><span style="color: #24292E">  });</span></li><li value="6"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">order</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> { prodNum: </span><span style="color: #005CC5">0</span><span style="color: #24292E">, prodAmt: </span><span style="color: #005CC5">0</span><span style="color: #24292E"> };</span></li><li value="7"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> order;</span></li><li value="8"><span style="color: #24292E">}</span></li></ol></pre>
    <p>The <code>shop</code> method accepts a <code>sellerInfo</code> object and returns an <code>order</code> object.</p>
  </li>
  <li>
    <p>In <em>index.rsh</em>, add the following constants to the top of the file:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">announcement</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Bytes</span><span style="color: #24292E">(</span><span style="color: #005CC5">28</span><span style="color: #24292E">);</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">product</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">Object</span><span style="color: #24292E">({ name: </span><span style="color: #6F42C1">Bytes</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">), unit: </span><span style="color: #6F42C1">Bytes</span><span style="color: #24292E">(</span><span style="color: #005CC5">6</span><span style="color: #24292E">), units: </span><span style="color: #6F42C1">Bytes</span><span style="color: #24292E">(</span><span style="color: #005CC5">8</span><span style="color: #24292E">), price: UInt })</span></li><li value="3"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">products</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">Array</span><span style="color: #24292E">(product, </span><span style="color: #005CC5">3</span><span style="color: #24292E">);</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.rsh</em>, add a <code>sellerInfo</code> property to <code>sellerInteract</code>:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #E36209">sellerInfo</span><span style="color: #24292E">: </span><span style="color: #005CC5">Object</span><span style="color: #24292E">({ announcement: announcement, products: products }),</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.rsh</em>, add a <code>shop</code> method to <code>buyerInteract</code>:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #E36209">shop</span><span style="color: #24292E">: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">(</span></li><li value="2"><span style="color: #24292E">  [</span><span style="color: #005CC5">Object</span><span style="color: #24292E">({ announcement: announcement, products: products })],</span></li><li value="3"><span style="color: #24292E">  </span><span style="color: #005CC5">Object</span><span style="color: #24292E">({ prodNum: UInt, prodAmt: UInt })</span></li><li value="4"><span style="color: #24292E">)</span></li></ol></pre>
    <p>This <code>shop</code> method also accepts a <code>sellerInfo</code> object and returns an <code>order</code> object.</p>
  </li>
  <li>
    <p>In <em>index.rsh</em>, find the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">();</span></li></ol></pre>
  </li>
  <li>
    <p>Replace it with the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">only</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sellerInfo</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">declassify</span><span style="color: #24292E">(interact.sellerInfo); });</span></li><li value="2"><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">(sellerInfo);</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.rsh</em>, find the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #005CC5">B</span><span style="color: #24292E">.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">();</span></li></ol></pre>
  </li>
  <li>
    <p>Replace it with the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #005CC5">B</span><span style="color: #24292E">.</span><span style="color: #6F42C1">only</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">order</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">declassify</span><span style="color: #24292E">(interact.</span><span style="color: #6F42C1">shop</span><span style="color: #24292E">(sellerInfo)); });</span></li><li value="2"><span style="color: #005CC5">B</span><span style="color: #24292E">.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">(order);</span></li></ol></pre>
  </li>
  <li>
    <p>Run your DApp in the seller and buyer terminals. Output should resemble the following:</p>
    <div class="row gx-3">
      <div class="col-12 col-lg-auto">
        <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is seller.</li><li value="2">The consensus network is ALGO.</li><li value="3">Your balance is 1000 ALGO.</li><li value="4">Contract info: 105</li><li value="5">Exiting contract.</li><li value="6">Your balance is 999.997 ALGO.</li></ol></pre>
      </div>
      <div class="col-12 col-lg-auto">
        <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is buyer.</li><li value="2">The consensus network is ALGO.</li><li value="3">Paste contract info:</li><li value="4">105</li><li value="5">Your balance is 1000 ALGO.</li><li value="6">List of products for sale:</li><li value="7">1. Potatoes at 200 ALGO per unit (bag).</li><li value="8">2. Carrots at 100 ALGO per unit (bunch).</li><li value="9">3. Corn at 50 ALGO per unit (ear).</li><li value="10">Exiting contract.</li><li value="11">Your balance is 999.998 ALGO.</li></ol></pre>
      </div>
    </div>
  </li>
</ol>
<h1 id="shop-for-products-buyer">Shop for products (buyer)</h1>
<p>This section enables the frontend to take the buyer's order (or cancellation), and pass it via the backend to the contract.</p>
<ol>
  <li>
    <p>In <em>index.mjs</em>, find the <code>shop</code> method in <code>buyerInteract</code>.</p>
  </li>
  <li>
    <p>Add Lines 7-14 which query the buyer about the product and amount:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #E36209">shop</span><span style="color: #24292E">: </span><span style="color: #D73A49">async</span><span style="color: #24292E"> (</span><span style="color: #E36209">sellerInfo</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(sellerInfo.announcement);</span></li><li value="3"><span style="color: #24292E">  sellerInfo.products.</span><span style="color: #6F42C1">forEach</span><span style="color: #24292E">((</span><span style="color: #E36209">p</span><span style="color: #24292E">, </span><span style="color: #E36209">i</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="4"><span style="color: #24292E">    console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`${</span><span style="color: #24292E">i</span><span style="color: #032F62"> </span><span style="color: #D73A49">+</span><span style="color: #032F62"> </span><span style="color: #005CC5">1</span><span style="color: #032F62">}. ${</span><span style="color: #24292E">p</span><span style="color: #032F62">.</span><span style="color: #24292E">name</span><span style="color: #032F62">} at ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #24292E">p</span><span style="color: #032F62">.</span><span style="color: #24292E">price</span><span style="color: #032F62">)</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">} per unit (${</span><span style="color: #24292E">p</span><span style="color: #032F62">.</span><span style="color: #24292E">unit</span><span style="color: #032F62">}).`</span><span style="color: #24292E">);</span></li><li value="5"><span style="color: #24292E">  });</span></li><li value="6"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">order</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> { prodNum: </span><span style="color: #005CC5">0</span><span style="color: #24292E">, prodAmt: </span><span style="color: #005CC5">0</span><span style="color: #24292E"> };</span></li><li value="7"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">prodNum</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(</span><span style="color: #032F62">`Enter 1-${</span><span style="color: #24292E">sellerInfo</span><span style="color: #032F62">.</span><span style="color: #24292E">products</span><span style="color: #032F62">.</span><span style="color: #005CC5">length</span><span style="color: #032F62">}, or 0 to exit:`</span><span style="color: #24292E">, (</span><span style="color: #E36209">x</span><span style="color: #24292E"> </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> x));</span></li><li value="8"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> prodNum </span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> prodNum </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> sellerInfo.products.</span><span style="color: #005CC5">length</span><span style="color: #24292E">) {</span></li><li value="9"><span style="color: #24292E">    order.prodNum </span><span style="color: #D73A49">=</span><span style="color: #24292E"> prodNum;</span></li><li value="10"><span style="color: #24292E">    order.prodAmt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(</span><span style="color: #032F62">`Enter number of units, or 0 to exit:`</span><span style="color: #24292E">, (</span><span style="color: #E36209">x</span><span style="color: #24292E"> </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> x));</span></li><li value="11"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">p</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> sellerInfo.products[order.prodNum </span><span style="color: #D73A49">-</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span></li><li value="12"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">unitWord</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> order.prodAmt </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #D73A49">?</span><span style="color: #24292E"> p.unit </span><span style="color: #D73A49">:</span><span style="color: #24292E"> p.units;</span></li><li value="13"><span style="color: #24292E">    console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`You are ordering ${</span><span style="color: #24292E">order</span><span style="color: #032F62">.</span><span style="color: #24292E">prodAmt</span><span style="color: #032F62">} ${</span><span style="color: #24292E">unitWord</span><span style="color: #032F62">} of ${</span><span style="color: #24292E">p</span><span style="color: #032F62">.</span><span style="color: #24292E">name</span><span style="color: #032F62">} at ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #24292E">p</span><span style="color: #032F62">.</span><span style="color: #24292E">price</span><span style="color: #032F62">)</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">} per ${</span><span style="color: #24292E">p</span><span style="color: #032F62">.</span><span style="color: #24292E">unit</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li><li value="14"><span style="color: #24292E">  }</span></li><li value="15"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> order;</span></li><li value="16"><span style="color: #24292E">}</span></li></ol></pre>
    <p>An order with <code>prodNum == 0</code> or <code>prodAmt == 0</code> means a cancelled order.</p>
  </li>
  <li>
    <p>In <em>index.mjs</em>, add <code>reportCancellation</code> to <code>commonInteract</code>:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #E36209">reportCancellation</span><span style="color: #24292E">: () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`${</span><span style="color: #24292E">role</span><span style="color: #032F62"> </span><span style="color: #D73A49">==</span><span style="color: #032F62"> </span><span style="color: #032F62">'buyer'</span><span style="color: #032F62"> </span><span style="color: #D73A49">?</span><span style="color: #032F62"> </span><span style="color: #032F62">'You'</span><span style="color: #032F62"> </span><span style="color: #D73A49">:</span><span style="color: #032F62"> </span><span style="color: #032F62">'The buyer'} cancelled the order.`</span><span style="color: #24292E">); }</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.rsh</em>, add <code>reportCancellation</code> to <code>commonInteract</code>:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #E36209">reportCancellation</span><span style="color: #24292E">: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([], Null)</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.rsh</em>, replace the last <code>commit()</code> with the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">if</span><span style="color: #24292E"> (order.prodNum </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E"> </span><span style="color: #D73A49">||</span><span style="color: #24292E"> order.prodNum </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> sellerInfo.products.</span><span style="color: #005CC5">length</span><span style="color: #24292E"> </span><span style="color: #D73A49">||</span><span style="color: #24292E"> order.prodAmt </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">) {</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="3"><span style="color: #24292E">  </span><span style="color: #6F42C1">each</span><span style="color: #24292E">([</span><span style="color: #005CC5">S</span><span style="color: #24292E">, </span><span style="color: #005CC5">B</span><span style="color: #24292E">], () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> interact.</span><span style="color: #6F42C1">reportCancellation</span><span style="color: #24292E">());</span></li><li value="4"><span style="color: #24292E">  </span><span style="color: #6F42C1">each</span><span style="color: #24292E">([</span><span style="color: #005CC5">S</span><span style="color: #24292E">, </span><span style="color: #005CC5">B</span><span style="color: #24292E">], () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> interact.</span><span style="color: #6F42C1">reportExit</span><span style="color: #24292E">());</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #6F42C1">exit</span><span style="color: #24292E">();</span></li><li value="6"><span style="color: #24292E">} </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></li><li value="7"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="8"><span style="color: #24292E">}</span></li></ol></pre>
  </li>
  <li>
    <p>Run your DApp in the seller and buyer terminals several times. As the buyer, when you specify an order, buyer output should include an order summary:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">You are ordering 2 bunches of Carrots at 100 ALGO per bunch.</li><li value="2">Exiting contract.</li><li value="3">Your balance is 999.998 ALGO.</li></ol></pre>
    <p>When you cancel an order (by setting <code>prodNum</code> or <code>prodAmt</code> to 0) output should indicate the cancellation:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">You cancelled the order.</li><li value="2">Exiting contract.</li><li value="3">Your balance is 999.998 ALGO.</li></ol></pre>
  </li>
</ol>
<h1 id="complete-a-transaction">Complete a transaction</h1>
<p>This section shows you how to do the following:</p>
<ol>
  <li>Implement contract code to calculate the total price of the transaction.</li>
  <li>Implement contract and frontend code to verify the transaction with the buyer.</li>
  <li>Implement contract code to complete the transaction.</li>
</ol>
<p>Here are the steps:</p>
<ol>
  <li>
    <p>In <em>index.mjs</em>, add a <code>confirmPurchase</code> method to <code>buyerInteract</code>:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #E36209">confirmPurchase</span><span style="color: #24292E">: </span><span style="color: #D73A49">async</span><span style="color: #24292E"> (</span><span style="color: #E36209">total</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(</span><span style="color: #032F62">`Do you want to complete the purchase for ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #24292E">total</span><span style="color: #032F62">)</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">}?`</span><span style="color: #24292E">, yesno)</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.rsh</em>, add a <code>confirmPurchase</code> method to <code>buyerInteract</code>:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #E36209">confirmPurchase</span><span style="color: #24292E">: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([UInt], Bool)</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.rsh</em>, add the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">only</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">total</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> sellerInfo.products[order.prodNum </span><span style="color: #D73A49">-</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">].price </span><span style="color: #D73A49">*</span><span style="color: #24292E"> order.prodAmt; });</span></li><li value="2"><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">(total);</span></li><li value="3"><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="4"></li><li value="5"><span style="color: #005CC5">B</span><span style="color: #24292E">.</span><span style="color: #6F42C1">only</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">willBuy</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">declassify</span><span style="color: #24292E">(interact.</span><span style="color: #6F42C1">confirmPurchase</span><span style="color: #24292E">(total)); });</span></li><li value="6"><span style="color: #005CC5">B</span><span style="color: #24292E">.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">(willBuy);</span></li><li value="7"></li><li value="8"><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">willBuy) {</span></li><li value="9"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="10"><span style="color: #24292E">  </span><span style="color: #6F42C1">each</span><span style="color: #24292E">([</span><span style="color: #005CC5">S</span><span style="color: #24292E">, </span><span style="color: #005CC5">B</span><span style="color: #24292E">], () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> interact.</span><span style="color: #6F42C1">reportCancellation</span><span style="color: #24292E">());</span></li><li value="11"><span style="color: #24292E">  </span><span style="color: #6F42C1">each</span><span style="color: #24292E">([</span><span style="color: #005CC5">S</span><span style="color: #24292E">, </span><span style="color: #005CC5">B</span><span style="color: #24292E">], () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> interact.</span><span style="color: #6F42C1">reportExit</span><span style="color: #24292E">());</span></li><li value="12"><span style="color: #24292E">  </span><span style="color: #6F42C1">exit</span><span style="color: #24292E">();</span></li><li value="13"><span style="color: #24292E">} </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></li><li value="14"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="15"><span style="color: #24292E">}</span></li><li value="16"></li><li value="17"><span style="color: #005CC5">B</span><span style="color: #24292E">.</span><span style="color: #6F42C1">pay</span><span style="color: #24292E">(total);</span></li><li value="18"><span style="color: #6F42C1">transfer</span><span style="color: #24292E">(total).</span><span style="color: #6F42C1">to</span><span style="color: #24292E">(</span><span style="color: #005CC5">S</span><span style="color: #24292E">);</span></li><li value="19"><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li></ol></pre>
    <p>Note that the contract (not the frontend) must calculate the total price to ensure transparency. Also note that the simple calculation shown here does not check whether <code>prodAmt</code> is less than available inventory, nor does it check whether <code>prodAmt * price</code> is less than the buyer's account balance. A production-ready calculation would include both checks.</p>
  </li>
  <li>
    <p>Run the DApp in the seller and buyer terminals, and purchase a reasonable amount of a product:</p>
    <div class="row gx-3">
      <div class="col-12 col-lg-auto">
        <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is seller.</li><li value="2">The consensus network is ALGO.</li><li value="3">Your balance is 1000 ALGO.</li><li value="4">Contract info: 161</li><li value="5">Exiting contract.</li><li value="6">Your balance is 1199.996 ALGO.</li></ol></pre>
      </div>
      <div class="col-12 col-lg-auto">
        <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is buyer.</li><li value="2">The consensus network is ALGO.</li><li value="3">Paste contract info:</li><li value="4">161</li><li value="5">Your balance is 1000 ALGO.</li><li value="6">List of products for sale:</li><li value="7">1. Potatoes at 200 ALGO per unit (bag).</li><li value="8">2. Carrots at 100 ALGO per unit (bunch).</li><li value="9">3. Corn at 50 ALGO per unit (ear).</li><li value="10">Enter 1-3, or 0 to exit:</li><li value="11">2</li><li value="12">Enter number of units, or 0 to exit:</li><li value="13">2</li><li value="14">You are ordering 2 bunches of Carrots at 100 ALGO per bunch.</li><li value="15">Do you want to complete the purchase for 200 ALGO?</li><li value="16">y</li><li value="17">Exiting contract.</li><li value="18">Your balance is 799.994 ALGO.</li></ol></pre>
      </div>
    </div>
    <p>Although the transaction completes successfully, the DApp does not provide enough information about the transaction to either participant. The following steps implement additional notifications.</p>
  </li>
  <li>
    <p>In <em>index.mjs</em>, add the following methods to <code>commonInteract</code>:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #E36209">reportPayment</span><span style="color: #24292E">: (</span><span style="color: #E36209">payment</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`${</span><span style="color: #24292E">role</span><span style="color: #032F62"> </span><span style="color: #D73A49">==</span><span style="color: #032F62"> </span><span style="color: #032F62">'buyer'</span><span style="color: #032F62"> </span><span style="color: #D73A49">?</span><span style="color: #032F62"> </span><span style="color: #032F62">'You'</span><span style="color: #032F62"> </span><span style="color: #D73A49">:</span><span style="color: #032F62"> </span><span style="color: #032F62">'The buyer'} paid ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #24292E">payment</span><span style="color: #032F62">)</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">} to the contract.`</span><span style="color: #24292E">),</span></li><li value="2"><span style="color: #E36209">reportTransfer</span><span style="color: #24292E">: (</span><span style="color: #E36209">payment</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`The contract paid ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #24292E">payment</span><span style="color: #032F62">)</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">} to ${</span><span style="color: #24292E">role</span><span style="color: #032F62"> </span><span style="color: #D73A49">==</span><span style="color: #032F62"> </span><span style="color: #032F62">'seller'</span><span style="color: #032F62"> </span><span style="color: #D73A49">?</span><span style="color: #032F62"> </span><span style="color: #032F62">'you'</span><span style="color: #032F62"> </span><span style="color: #D73A49">:</span><span style="color: #032F62"> </span><span style="color: #032F62">'the seller'}.`</span><span style="color: #24292E">),</span></li><li value="3"><span style="color: #E36209">reportFulfillment</span><span style="color: #24292E">: (</span><span style="color: #E36209">p</span><span style="color: #24292E">, </span><span style="color: #E36209">amt</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { </span></li><li value="4"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">subjectVerb</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> role </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">'seller'</span><span style="color: #24292E"> </span><span style="color: #D73A49">?</span><span style="color: #24292E"> </span><span style="color: #032F62">'You owe'</span><span style="color: #24292E"> </span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #032F62">'The seller owes'</span><span style="color: #24292E">;</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">directObject</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> role </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">'buyer'</span><span style="color: #24292E"> </span><span style="color: #D73A49">?</span><span style="color: #24292E"> </span><span style="color: #032F62">'you'</span><span style="color: #24292E"> </span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #032F62">'the buyer'</span><span style="color: #24292E">;</span></li><li value="6"><span style="color: #24292E">  console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`${</span><span style="color: #24292E">subjectVerb</span><span style="color: #032F62">} ${</span><span style="color: #24292E">directObject</span><span style="color: #032F62">} ${</span><span style="color: #24292E">amt</span><span style="color: #032F62">} ${</span><span style="color: #24292E">amt</span><span style="color: #032F62"> </span><span style="color: #D73A49">==</span><span style="color: #032F62"> </span><span style="color: #005CC5">1</span><span style="color: #032F62"> </span><span style="color: #D73A49">?</span><span style="color: #032F62"> </span><span style="color: #24292E">p</span><span style="color: #032F62">.</span><span style="color: #24292E">unit</span><span style="color: #032F62"> </span><span style="color: #D73A49">:</span><span style="color: #032F62"> </span><span style="color: #24292E">p</span><span style="color: #032F62">.</span><span style="color: #24292E">units</span><span style="color: #032F62">} of ${</span><span style="color: #24292E">p</span><span style="color: #032F62">.</span><span style="color: #24292E">name</span><span style="color: #032F62">}.`</span><span style="color: #24292E">); </span></li><li value="7"><span style="color: #24292E">}</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.rsh</em>, add the same methods to <code>commonInteract</code>:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #E36209">reportPayment</span><span style="color: #24292E">: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([UInt], Null),</span></li><li value="2"><span style="color: #E36209">reportTransfer</span><span style="color: #24292E">: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([UInt], Null),</span></li><li value="3"><span style="color: #E36209">reportFulfillment</span><span style="color: #24292E">: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([product, UInt], Null),</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.rsh</em>, add Lines 2, 4, and 5 to call these methods:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #005CC5">B</span><span style="color: #24292E">.</span><span style="color: #6F42C1">pay</span><span style="color: #24292E">(total);</span></li><li value="2"><span style="color: #6F42C1">each</span><span style="color: #24292E">([</span><span style="color: #005CC5">S</span><span style="color: #24292E">, </span><span style="color: #005CC5">B</span><span style="color: #24292E">], () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> interact.</span><span style="color: #6F42C1">reportPayment</span><span style="color: #24292E">(total));</span></li><li value="3"><span style="color: #6F42C1">transfer</span><span style="color: #24292E">(total).</span><span style="color: #6F42C1">to</span><span style="color: #24292E">(</span><span style="color: #005CC5">S</span><span style="color: #24292E">);</span></li><li value="4"><span style="color: #6F42C1">each</span><span style="color: #24292E">([</span><span style="color: #005CC5">S</span><span style="color: #24292E">, </span><span style="color: #005CC5">B</span><span style="color: #24292E">], () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> interact.</span><span style="color: #6F42C1">reportTransfer</span><span style="color: #24292E">(total));</span></li><li value="5"><span style="color: #6F42C1">each</span><span style="color: #24292E">([</span><span style="color: #005CC5">S</span><span style="color: #24292E">, </span><span style="color: #005CC5">B</span><span style="color: #24292E">], () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> interact.</span><span style="color: #6F42C1">reportFulfillment</span><span style="color: #24292E">(sellerInfo.products[order.prodNum </span><span style="color: #D73A49">-</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">], order.prodAmt));</span></li><li value="6"><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li></ol></pre>
  </li>
  <li>
    <p>Run the DApp. The output should include lines similar to the following:</p>
    <div class="row gx-3">
      <div class="col-12 col-lg-auto">
        <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is seller.</li><li value="2">...</li><li value="3">The buyer paid 250 ALGO to the contract.</li><li value="4">The contract paid 250 ALGO to you.</li><li value="5">You owe the buyer 5 ears of Corn.</li></ol></pre>
      </div>
      <div class="col-12 col-lg-auto">
        <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is buyer.</li><li value="2">...</li><li value="3">You paid 250 ALGO to the contract.</li><li value="4">The contract paid 250 ALGO to the seller.</li><li value="5">The seller owes you 5 ears of Corn.</li></ol></pre>
      </div>
    </div>
  </li>
</ol>
<h1 id="view-the-contract">View the contract</h1>
<h1 id="examine-the-webapp">Examine the webapp</h1>
<h1 id="self-assessment">Self assessment</h1>