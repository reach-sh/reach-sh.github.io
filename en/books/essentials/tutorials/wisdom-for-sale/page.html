<p><span style="color:red;">Under Construction</span></p>
<p>This tutorial introduces you to Reach DApp development by showing you how to build <em>Wisdom for Sale</em>, a command-line and web decentralized application that enables a seller and a buyer to exchange wisdom for crypto via a smart contract running on an Algorand, Ethereum, or Conflux local consensus network:</p>
<p><strong>Seller</strong></p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1">The consensus network is ETH.</li><li value="2">Your role is seller.</li><li value="3">Enter a wise phrase, or press Enter to use a default wise phrase:</li><li value="4">Scatter sunshine.</li><li value="5">Your balance is 1000 ETH.</li><li value="6">Your wisdom is for sale at 5 ETH.</li><li value="7">Contract info for buyer: 0xABC</li><li value="8">The buyer paid 5 ETH to the contract.</li><li value="9">The contract paid 5 ETH to you.</li><li value="10">Your balance is 1004.9975 ETH.</li></ol></pre>
<p><strong>Buyer</strong></p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1">The consensus network is ETH.</li><li value="2">Your role is buyer.</li><li value="3">Paste contract info:</li><li value="4">0xABC</li><li value="5">Your balance is 1000 ETH.</li><li value="6">Do you want to purchase wisdom for 5 ETH?</li><li value="7">y</li><li value="8">You paid 5 ETH to the contract.</li><li value="9">The contract paid 5 ETH to the seller.</li><li value="10">Your new wisdom is "Scatter sunshine."</li><li value="11">Your balance is 994.9996 ETH.</li></ol></pre>
<p>Be sure to complete <a href="/en/books/essentials/quick-start/">Quick Start</a> and <a href="/en/books/essentials/developer-environment/">Development Environment</a> first.</p>
<h1 id="clone-the-repository">Clone the repository</h1>
<ol>
  <li>
    <p>Clone the <a href="https://github.com/hagenhaus/wisdom-for-sale">wisdom-for-sale</a> repository:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1">$ cd ~/reach</li><li value="2">$ git clone https://github.com/hagenhaus/wisdom-for-sale.git</li></ol></pre>
  </li>
  <li>
    <p>Open the repository in vscode.</p>
  </li>
  <li>
    <p>Understand the directory structure.</p>
  </li>
  <li>
    <p>See the <em>current</em> folder. Do work here.</p>
  </li>
  <li>
    <p>Understand use of <em>readme.md</em> in the <em>current</em> folder.</p>
  </li>
</ol>
<h1 id="copy-the-starter-files">Copy the starter files</h1>
<p>Copy starter files from the <em>starter</em> folder to the <em>current</em> folder:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1">$ cp starter/* current</li><li value="2">$ cd current</li></ol></pre>
<p>Open the starter files.</p>
<p><a href="https://github.com/hagenhaus/wisdom-for-sale/blob/master/starter/index.mjs">index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">import</span><span style="color: #24292E"> { loadStdlib } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'@reach-sh/stdlib'</span><span style="color: #24292E">;</span></li><li value="2"><span style="color: #D73A49">import</span><span style="color: #24292E"> </span><span style="color: #005CC5">*</span><span style="color: #24292E"> </span><span style="color: #D73A49">as</span><span style="color: #24292E"> backend </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'./build/index.main.mjs'</span><span style="color: #24292E">;</span></li><li value="3"><span style="color: #D73A49">import</span><span style="color: #24292E"> { ask, yesno, done } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'@reach-sh/stdlib/ask.mjs'</span><span style="color: #24292E">;</span></li><li value="4"></li><li value="5"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">stdlib</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">loadStdlib</span><span style="color: #24292E">(process.env);</span></li><li value="6"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`The consensus network is ${</span><span style="color: #24292E">stdlib</span><span style="color: #032F62">.</span><span style="color: #24292E">connector</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li><li value="7"></li><li value="8"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">role</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">'seller'</span><span style="color: #24292E">;</span></li><li value="9"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Your role is ${</span><span style="color: #24292E">role</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li><li value="10"></li><li value="11"><span style="color: #24292E">(</span><span style="color: #D73A49">async</span><span style="color: #24292E"> () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="12"></li><li value="13"><span style="color: #24292E">  </span><span style="color: #6A737D">// SELLER</span></li><li value="14"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (role </span><span style="color: #D73A49">===</span><span style="color: #24292E"> </span><span style="color: #032F62">'seller'</span><span style="color: #24292E">) {</span></li><li value="15"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">acc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">newTestAccount</span><span style="color: #24292E">(stdlib.</span><span style="color: #6F42C1">parseCurrency</span><span style="color: #24292E">(</span><span style="color: #005CC5">1000</span><span style="color: #24292E">));</span></li><li value="16"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">ctc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> acc.</span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">(backend);</span></li><li value="17"><span style="color: #24292E">    </span><span style="color: #D73A49">await</span><span style="color: #24292E"> backend.</span><span style="color: #6F42C1">Seller</span><span style="color: #24292E">(ctc, {});</span></li><li value="18"><span style="color: #24292E">  }</span></li><li value="19"></li><li value="20"><span style="color: #24292E">  </span><span style="color: #6A737D">// BUYER</span></li><li value="21"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></li><li value="22"><span style="color: #24292E">  }</span></li><li value="23"></li><li value="24"><span style="color: #24292E">  </span><span style="color: #6F42C1">done</span><span style="color: #24292E">();</span></li><li value="25"><span style="color: #24292E">})();</span></li></ol></pre>
<p><a href="https://github.com/hagenhaus/wisdom-for-sale/blob/master/starter/index.rsh">index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #032F62">'reach 0.1'</span><span style="color: #24292E">;</span></li><li value="2"></li><li value="3"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">main</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Reach.</span><span style="color: #6F42C1">App</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="4"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">S</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Seller'</span><span style="color: #24292E">, {});</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">B</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Buyer'</span><span style="color: #24292E">, {});</span></li><li value="6"><span style="color: #24292E">  </span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">();</span></li><li value="7"></li><li value="8"><span style="color: #24292E">  </span><span style="color: #6F42C1">exit</span><span style="color: #24292E">();</span></li><li value="9"><span style="color: #24292E">});</span></li></ol></pre>
<p>Describe each line, and review modern JavaScript usage like async/await.</p>
<h1 id="run-your-new-app">Run your new app</h1>
<p>Run the starter app in the vscode terminal.</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1">$ REACH_CONNECTOR_MODE=ALGO-devnet reach run</li><li value="2">$ REACH_CONNECTOR_MODE=ETH-devnet reach run</li><li value="3">$ REACH_CONNECTOR_MODE=CFX-devnet reach run</li></ol></pre>
<p>What happens when you run <code>reach run</code>?</p>
<h2 id="review-build-files">Review build files</h2>
<p>You see the following directory and files appear. Some files disappear.</p>
<ul>
  <li>build/index.main.mjs</li>
  <li>.dockerignore</li>
  <li>.gitignore</li>
  <li>Dockerfile</li>
  <li>package.json</li>
</ul>
<p>Understand significance.</p>
<p>Explain <code>reach scaffold</code>.</p>
<h2 id="review-docker-environment">Review Docker environment</h2>
<p>You see</p>
<p>
  current
  solution
  starter
</p>
<h1 id="pass-arguments">Pass arguments</h1>
<p>This section represents the first change that the developer makes to the project.</p>
<p>Replace <code>const role = 'seller';</code> with the following:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">if</span><span style="color: #24292E"> (process.argv.</span><span style="color: #005CC5">length</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E"> </span><span style="color: #D73A49">||</span><span style="color: #24292E"> [</span><span style="color: #032F62">'seller'</span><span style="color: #24292E">, </span><span style="color: #032F62">'buyer'</span><span style="color: #24292E">].</span><span style="color: #6F42C1">includes</span><span style="color: #24292E">(process.argv[</span><span style="color: #005CC5">2</span><span style="color: #24292E">]) </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">) {</span></li><li value="2"><span style="color: #24292E">  console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">'Usage: reach run index [seller|buyer]'</span><span style="color: #24292E">);</span></li><li value="3"><span style="color: #24292E">  process.</span><span style="color: #6F42C1">exit</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></li><li value="4"><span style="color: #24292E">}</span></li><li value="5"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">role</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> process.argv[</span><span style="color: #005CC5">2</span><span style="color: #24292E">];</span></li></ol></pre>
<h2 id="run-in-two-terminals">Run in two terminals</h2>
<p>Open two terminals (i.e. shells) positioned side by side.</p>
<p>Change directory in both to <code>~/reach/wisdom-for-sale/current</code>.</p>
<p>The left terminal is the <em>Seller Terminal</em>. In this terminal, run one of the following:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1">$ REACH_CONNECTOR_MODE=ALGO-devnet reach run index seller</li><li value="2">$ REACH_CONNECTOR_MODE=ETH-devnet reach run index seller</li><li value="3">$ REACH_CONNECTOR_MODE=CFX-devnet reach run index seller</li></ol></pre>
<p>The right terminal is the <em>Buyer Terminal</em>. In this terminal, run the corresponding command:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1">$ REACH_CONNECTOR_MODE=ALGO-devnet reach run index buyer</li><li value="2">$ REACH_CONNECTOR_MODE=ETH-devnet reach run index buyer</li><li value="3">$ REACH_CONNECTOR_MODE=CFX-devnet reach run index buyer</li></ol></pre>
<p>Try all of them if you like. Use these two terminal for the rest of the tutorial.</p>
<h2 id="about-adding-node-packages">About adding Node packages</h2>
<p>Explain that <code>reach scaffold</code> produces a <em>package.json</em> file useful for adding Node.js packages (e.g. <a href="https://www.npmjs.com/package/yargs">yargs</a>) not covered in this tutorial.</p>
<h2 id="environment-variable-limits">Environment variable Limits</h2>
<p>Discuss ways to pass information to Reach command-line apps. Setting an environment variable does not work. Explain why.</p>
<h1 id="use-the-reach-stdlib">Use the Reach Stdlib</h1>
<h2 id="review-current-usage">Review current usage</h2>
<pre class="snippet numbered"><ol class="snippet"><li value="1">stdlib.connector();</li><li value="2">stdlib.parseCurrency();</li><li value="3">stdlib.newTestAccount();</li></ol></pre>
<h2 id="inspect-stdlib">Inspect Stdlib</h2>
<p>Temporarily add the following just below <code>const stdlib = loadStdlib(process.env)</code>:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1">console.log(stdlib);</li></ol></pre>
<p>Run the following in the Seller Terminal:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1">$ reach run index seller &gt; output.txt</li></ol></pre>
<p>Inspect <em>output.txt</em> which displays Reach Stdlib properties, methods, and objects. Reach frontends and backends leverage this library. <a href="/en/books/essentials/support-for-js-frontends/">Support for JS Frontends</a> documents that portion of the library intended for frontends.</p>
<p>Remove the <code>console.log</code> statement.</p>
<h2 id="leverage-additional-methods">Leverage additional methods</h2>
<p>Add the following just below <code>const stdlib = loadStdlib(process.env)</code>:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">suStr</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> stdlib.standardUnit;</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #E36209">su</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">parseCurrency</span><span style="color: #24292E">(su);</span></li><li value="3"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toSU</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #E36209">au</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">formatCurrency</span><span style="color: #24292E">(au, </span><span style="color: #005CC5">4</span><span style="color: #24292E">);</span></li><li value="4"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">iBalance</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E">(</span><span style="color: #005CC5">1000</span><span style="color: #24292E">);</span></li><li value="5"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">async</span><span style="color: #24292E"> (</span><span style="color: #E36209">acc</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Your balance is ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #D73A49">await</span><span style="color: #032F62"> </span><span style="color: #24292E">stdlib</span><span style="color: #032F62">.</span><span style="color: #6F42C1">balanceOf</span><span style="color: #032F62">(</span><span style="color: #24292E">acc</span><span style="color: #032F62">))</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li></ol></pre>
<p>Explain each of these.</p>
<p>Replace <code>stdlib.parseCurrency(1000)</code> with <code>iBalance</code>.</p>
<p>Add <code>showBalance</code> in two places like this:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1">const acc = await stdlib.newTestAccount(iBalance);</li><li value="2">await showBalance(acc);</li><li value="3">const ctc = acc.deploy(backend);</li><li value="4">await backend.Seller(ctc, {});</li><li value="5">await showBalance(acc);</li></ol></pre>
<p>Run the app in the Seller Terminal. Here is the output:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1">The consensus network is ETH.</li><li value="2">Your role is seller.</li><li value="3">Your balance is 1000 ETH.</li><li value="4">Your balance is 1000 ETH.</li></ol></pre>
<h1 id="add-seller-interact">Add seller interact</h1>
<h2 id="add-seller-frontend-interact">Add seller frontend interact</h2>
<p>Add an interact object to <em>index.mjs</em> for the seller.</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #6A737D">// SELLER INTERACT</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sellerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="3"><span style="color: #24292E">  price: </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E">(</span><span style="color: #005CC5">5</span><span style="color: #24292E">),</span></li><li value="4"><span style="color: #24292E">  wisdom: </span><span style="color: #032F62">'Scatter sunshine.'</span><span style="color: #24292E">,</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #6F42C1">reportReady</span><span style="color: #24292E">: </span><span style="color: #D73A49">async</span><span style="color: #24292E"> (</span><span style="color: #E36209">price</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="6"><span style="color: #24292E">    console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Your wisdom is for sale at ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #24292E">price</span><span style="color: #032F62">)</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li><li value="7"><span style="color: #24292E">    console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Contract info for buyer: ${</span><span style="color: #D73A49">await</span><span style="color: #032F62"> </span><span style="color: #24292E">ctc</span><span style="color: #032F62">.</span><span style="color: #6F42C1">getInfo</span><span style="color: #032F62">()</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li><li value="8"><span style="color: #24292E">  }</span></li><li value="9"><span style="color: #24292E">};</span></li></ol></pre>
<p>Replace <code>await backend.Seller(ctc, {})</code> with <code>await backend.Seller(ctc, sellerInteract);</code>.</p>
<h2 id="add-seller-backend-interact">Add seller backend interact</h2>
<p>Add a corresponding interact object to <em>index.rsh</em> for the seller.</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1">// SELLER INTERACT</li><li value="2">const sellerInteract = {</li><li value="3">  price: UInt,</li><li value="4">  wisdom: Bytes(128),</li><li value="5">  reportReady: Fun([UInt], Null)</li><li value="6">};</li></ol></pre>
<p>Replace <code>const S = Participant('Seller', {})</code> with <code>const S = Participant('Seller', sellerInteract)</code>.</p>
<h2 id="add-seller-local-step">Add seller local step</h2>
<p>Add a local step for seller:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1">S.only(() =&gt; { const price = declassify(interact.price); });</li><li value="2">S.publish(price);</li><li value="3">S.interact.reportReady(price);</li><li value="4">commit();</li></ol></pre>
<h2 id="test-seller-interact">Test seller interact</h2>
<p>Run in the Seller Terminal:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1">The consensus network is ETH.</li><li value="2">Your role is seller.</li><li value="3">Your balance is 1000 ETH.</li><li value="4">Your wisdom is for sale at 5 ETH.</li><li value="5">Contract info for buyer: 0xbBD687F2cCa8AC0cB4c51ff0Da9632eF32aC1F7D.</li><li value="6">Your balance is 999.9998 ETH.</li></ol></pre>
<h1 id="add-buyer-interact">Add buyer interact</h1>
<h2 id="add-buyer-frontend-interact">Add buyer frontend interact</h2>
<h2 id="add-buyer-backend-interact">Add buyer backend interact</h2>
<h2 id="add-buyer-local-step">Add buyer local step</h2>
<h2 id="test-buyer-interact">Test buyer interact</h2>