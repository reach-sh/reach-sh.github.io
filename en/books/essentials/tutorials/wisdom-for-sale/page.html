<p><span style="color:red;">Under construction. To provide feedback about this tutorial, click the pencil icon, click issues, and create an issue. Thanks!</span></p>
<p>This tutorial introduces you to Reach DApp development. The tutorial is easy and fun, and it prepares you for more advanced Reach tutorials and projects. Be sure to complete <a href="/en/books/essentials/quick-start/">Quick Start</a> and <a href="/en/books/essentials/developer-environment/">Development Environment</a> first.</p>
<h1 id="overview">Overview</h1>
<p>During this tutorial, you will build a command-line version and a webapp version of <a href="https://github.com/hagenhaus/wisdom-for-sale">Wisdom for Sale</a>, an application that enables two participants, a seller and a buyer, to trade wisdom for currency via a smart contract running on a private Algorand, Ethereum, or Conflux consensus network (e.g. devnet) residing in a Docker container on your computer. Your DApp will create and fund an account for each participant. Then, it will enable the seller and buyer to make a deal.</p>
<h2 id="wisdom-for-tokens">Wisdom for Tokens</h2>
<p>The following diagram represents the wisdom-for-sale deal.</p>
<div>
  <img src="/en/books/essentials/tutorials/wisdom-for-sale/seller-buyer.png" class="img-fluid my-4 d-block" width="800" height="317" loading="lazy">
</div>
<p>This particular transaction took place on an Ethereum devnet. The Ethereum cryptocurrency standard token unit is the <em>Ether</em> or <em>ETH</em>. The tutorial also allows you to perform this transaction on an Algorand or Conflux devnet. The Algorand standard unit is the <em>ALGO</em>, and the Conflux standard unit is the <em>CFX</em>. As indicated by the final balances in the diagram, the seller received 0.0019 ETH less than the agreed upon price, and the buyer paid 0.0003 ETH more. These expenses represent <em>gas</em>, the cost of doing business on a consensus network. The seller paid a little more gas than the buyer because the seller deployed the contract.</p>
<h2 id="start-to-finish-video">Start-to-finish Video</h2>
<p>Speaking of contracts, creating a Reach DApp does <em>not</em> entail implementing a smart contract. Rather, it means using the Reach programming language to describe, step by step (in <em>index.rsh</em>) participant interactions from which the Reach compiler derives a smart contract. The following video illustrates:</p>
<p class="ratio ratio-16x9 my-4" style="max-width:500px;">
  <iframe src="https://www.youtube.com/embed/_hh2Vm9OdZ0" frameborder="0" allowfullscreen=""></iframe>
</p>
<p>Developers use the Reach programming language to write (in <em>index.rsh</em>) the pre-compiled backend code that, syntactically, follows modern JavaScript rules. Here is an appreviated sample:</p>
<p><a href="https://github.com/hagenhaus/wisdom-for-sale/blob/master/starter/index.rsh">index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #032F62">'reach 0.1'</span><span style="color: #24292E">;</span></li><li value="2"></li><li value="3"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">main</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Reach.</span><span style="color: #6F42C1">App</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="4"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">S</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Seller'</span><span style="color: #24292E">, {});</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">B</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Buyer'</span><span style="color: #24292E">, {});</span></li><li value="6"><span style="color: #24292E">  </span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">();</span></li><li value="7"></li><li value="8"><span style="color: #24292E">  </span><span style="color: #6F42C1">exit</span><span style="color: #24292E">();</span></li><li value="9"><span style="color: #24292E">});</span></li></ol></pre>
<p>The Reach compiler transforms <em>reach.rsh</em> into <em>index.main.mjs</em>, the compiled backend code composed of two parts:</p>
<ol>
  <li>
    <p>The Gateway facilitates communication between your frontend and the consensus network. It is compiler-generated JavaScript:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">_version</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">'0.1.5'</span><span style="color: #24292E">;</span></li><li value="2"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">_backendVersion</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E">;</span></li><li value="3"><span style="color: #D73A49">...</span></li><li value="4"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">async</span><span style="color: #24292E"> </span><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Buyer</span><span style="color: #24292E">(</span><span style="color: #E36209">ctc</span><span style="color: #24292E">, </span><span style="color: #E36209">interact</span><span style="color: #24292E">) {</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #D73A49">...</span></li><li value="6"><span style="color: #24292E">};</span></li><li value="7"></li><li value="8"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">async</span><span style="color: #24292E"> </span><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Seller</span><span style="color: #24292E">(</span><span style="color: #E36209">ctc</span><span style="color: #24292E">, </span><span style="color: #E36209">interact</span><span style="color: #24292E">) {</span></li><li value="9"><span style="color: #24292E">  </span><span style="color: #D73A49">...</span></li><li value="10"><span style="color: #24292E">};</span></li></ol></pre>
  </li>
  <li>
    <p>The Smart Contract is deployed to the consensus network where it facilitates participant transactions. It is compiler-generated JSON and (network-specific) bytecode:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">_ETH</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  ABI: </span><span style="color: #032F62">`[...]`</span><span style="color: #24292E">,</span></li><li value="3"><span style="color: #24292E">  Bytecode: </span><span style="color: #032F62">`0x6080604052604051610b19 ...`</span><span style="color: #24292E">,</span></li><li value="4"><span style="color: #24292E">  BytecodeLen: </span><span style="color: #005CC5">2841</span><span style="color: #24292E">,</span></li><li value="5"><span style="color: #24292E">  Which: </span><span style="color: #032F62">`oD`</span><span style="color: #24292E">,</span></li><li value="6"><span style="color: #24292E">  version: </span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span></li><li value="7"><span style="color: #24292E">  views: {}</span></li><li value="8"><span style="color: #24292E">};</span></li></ol></pre>
  </li>
</ol>
<blockquote>
  <p>This tutorial presents frontends written in JavaScript, but Reach also supports, via the <a href="/en/books/essentials/support-for-rpc-frontends/">Reach RPC Server</a>, frontends written in various languages.</p>
</blockquote>
<p>Also mentioned in the video are (1) the Reach <a href="/en/books/essentials/support-for-js-frontends/">JavaScript Standard Library</a> which supports Reach applications by providing properties and methods dealing with accounts, arithmetic, big numbers, comparisons, consensus network providers, contracts, debugging, encryption, randomization, and time, (2) interact objects which are JavaScript objects that enable communication between Reach frontends and backends, explained in detail below, and (3) the Reach Verification Engine which helps to ensure that the immutable smart contract you deploy will run without errors like forgetting to transfer all the otherwise unretrievable tokens out of smart contract account before the contract exits.</p>
<h1 id="clone-the-repository">Clone the repository</h1>
<p>Before proceeding, be sure to complete <a href="/en/books/essentials/quick-start/">Quick Start</a> and <a href="/en/books/essentials/developer-environment/">Development Environment</a>.</p>
<ol>
  <li>
    <p>Clone the <a href="https://github.com/hagenhaus/wisdom-for-sale">wisdom-for-sale</a> repository:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ cd ~/reach</li><li value="2">$ git clone https://github.com/hagenhaus/wisdom-for-sale.git</li></ol></pre>
  </li>
  <li>
    <p>Open the repository in vscode.</p>
    <p>
      <img src="/en/books/essentials/tutorials/wisdom-for-sale/vscode-initial.png" class="img-fluid" width="700" loading="lazy">
    </p>
  </li>
  <li>
    <p>Copy <em>index.mjs</em> and <em>index.rsh</em> from the <em>starter</em> folder to the <em>current</em> folder. Do all your work in the <em>current</em> folder.</p>
  </li>
</ol>
<h1 id="review-the-starter-files">Review the starter files</h1>
<h2 id="indexmjs">index.mjs</h2>
<p>Open <a href="https://github.com/hagenhaus/wisdom-for-sale/blob/master/starter/index.mjs">index.mjs</a> in vscode.</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">import</span><span style="color: #24292E"> { loadStdlib } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'@reach-sh/stdlib'</span><span style="color: #24292E">;</span></li><li value="2"><span style="color: #D73A49">import</span><span style="color: #24292E"> </span><span style="color: #005CC5">*</span><span style="color: #24292E"> </span><span style="color: #D73A49">as</span><span style="color: #24292E"> backend </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'./build/index.main.mjs'</span><span style="color: #24292E">;</span></li><li value="3"><span style="color: #D73A49">import</span><span style="color: #24292E"> { ask, yesno, done } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'@reach-sh/stdlib/ask.mjs'</span><span style="color: #24292E">;</span></li><li value="4"></li><li value="5"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">stdlib</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">loadStdlib</span><span style="color: #24292E">(process.env);</span></li><li value="6"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`The consensus network is ${</span><span style="color: #24292E">stdlib</span><span style="color: #032F62">.</span><span style="color: #24292E">connector</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li><li value="7"></li><li value="8"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">role</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">'seller'</span><span style="color: #24292E">;</span></li><li value="9"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Your role is ${</span><span style="color: #24292E">role</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li><li value="10"></li><li value="11"><span style="color: #24292E">(</span><span style="color: #D73A49">async</span><span style="color: #24292E"> () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="12"></li><li value="13"><span style="color: #24292E">  </span><span style="color: #6A737D">// SELLER</span></li><li value="14"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (role </span><span style="color: #D73A49">===</span><span style="color: #24292E"> </span><span style="color: #032F62">'seller'</span><span style="color: #24292E">) {</span></li><li value="15"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">acc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">newTestAccount</span><span style="color: #24292E">(stdlib.</span><span style="color: #6F42C1">parseCurrency</span><span style="color: #24292E">(</span><span style="color: #005CC5">1000</span><span style="color: #24292E">));</span></li><li value="16"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">ctc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> acc.</span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">(backend);</span></li><li value="17"><span style="color: #24292E">    </span><span style="color: #D73A49">await</span><span style="color: #24292E"> backend.</span><span style="color: #6F42C1">Seller</span><span style="color: #24292E">(ctc, {});</span></li><li value="18"><span style="color: #24292E">  }</span></li><li value="19"></li><li value="20"><span style="color: #24292E">  </span><span style="color: #6A737D">// BUYER</span></li><li value="21"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></li><li value="22"><span style="color: #24292E">  }</span></li><li value="23"></li><li value="24"><span style="color: #24292E">  </span><span style="color: #6F42C1">done</span><span style="color: #24292E">();</span></li><li value="25"><span style="color: #24292E">})();</span></li></ol></pre>
<ul>
  <li>Line 1: Import the Reach JS Standard Library loader.</li>
  <li>Line 2: Import the JS backend compiled from index.rsh.</li>
  <li>Line 3: Import a Reach Node.js package to help with command-line i/o.</li>
  <li>Line 5: Load the Reach JS Stdlib for the consensus network specified by the <code>REACH_CONNECTOR_MODE</code>.</li>
  <li>Line 6: Display the consensus network type.</li>
  <li>Line 8: Hard-code the role. You will change this later.</li>
  <li>Line 9: Display the role.</li>
  <li>Line 11: Enable enclosed code to await the fulfillment of promises.</li>
  <li>Line 14: Code for when you run this app as the seller.</li>
  <li>Line 15: Create an account for the seller. <em>parseCurrency</em> transforms units from standard to atomic.</li>
  <li>Line 16: Get a reference to the contract.</li>
  <li>Line 17: Call <code>Seller(ctc, interact)</code> in <em>index.main.mjs</em> which deploys the contract.</li>
  <li>Line 24: Tell <em>ask.mjs</em> that you are finished.</li>
</ul>
<h2 id="indexrsh">index.rsh</h2>
<p>Open <a href="https://github.com/hagenhaus/wisdom-for-sale/blob/master/starter/index.rsh">index.rsh</a> in vscode.</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #032F62">'reach 0.1'</span><span style="color: #24292E">;</span></li><li value="2"></li><li value="3"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">main</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Reach.</span><span style="color: #6F42C1">App</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="4"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">S</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Seller'</span><span style="color: #24292E">, {});</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">B</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Buyer'</span><span style="color: #24292E">, {});</span></li><li value="6"><span style="color: #24292E">  </span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">();</span></li><li value="7"></li><li value="8"><span style="color: #24292E">  </span><span style="color: #6F42C1">exit</span><span style="color: #24292E">();</span></li><li value="9"><span style="color: #24292E">});</span></li></ol></pre>
<ul>
  <li>Line 1: Instruction to the compiler.</li>
  <li>Line 3: Reach standard application initialization.</li>
  <li>Line 4: Define a constant to represent the seller. The <code>{}</code> indicates an empty interact object.</li>
  <li>Line 5: Define a constant to represent the buyer. Same.</li>
  <li>Line 6: Finalize participant and other options.</li>
  <li>Line 8: Terminate computation.</li>
</ul>
<h1 id="run-the-app">Run the app</h1>
<p>The following diagram illustrates your environment before you run your starter app. Your application consists of your frontend (index.mjs), your backend (index.rsh), and the Reach Docker environment where everything will run: the Reach compiler, your application, the consensus network devnets, and your smart contract.</p>
<p>
  <img src="/en/books/essentials/tutorials/wisdom-for-sale/reach-run-1.png" class="img-fluid" width="420" loading="lazy">
</p>
<p>Now, run your starter app in the vscode terminal three times, once for each supported consensus network. Use the commands below in succession, and note the output:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ REACH_CONNECTOR_MODE=ALGO-devnet reach run</li><li value="2">$ REACH_CONNECTOR_MODE=ETH-devnet reach run</li><li value="3">$ REACH_CONNECTOR_MODE=CFX-devnet reach run</li></ol></pre>
<p>
  <img src="/en/books/essentials/tutorials/wisdom-for-sale/vscode-run.png" class="img-fluid" width="700" loading="lazy">
</p>
<p>Here's what happens when you run <code>reach run</code>:</p>
<ol>
  <li>
    <p>sss</p>
    <p>
      <img src="/en/books/essentials/tutorials/wisdom-for-sale/reach-run-2.png" class="img-fluid" width="420" loading="lazy">
    </p>
  </li>
  <li>
    <p>sss</p>
    <p>
      <img src="/en/books/essentials/tutorials/wisdom-for-sale/reach-run-3.png" class="img-fluid" width="420" loading="lazy">
    </p>
  </li>
  <li>
    <p>sss</p>
    <p>
      <img src="/en/books/essentials/tutorials/wisdom-for-sale/reach-run-4.png" class="img-fluid" width="420" loading="lazy">
    </p>
  </li>
  <li>
    <p>sss</p>
    <p>
      <img src="/en/books/essentials/tutorials/wisdom-for-sale/reach-run-5.png" class="img-fluid" width="420" loading="lazy">
    </p>
  </li>
  <li>
    <p>sss</p>
    <p>
      <img src="/en/books/essentials/tutorials/wisdom-for-sale/reach-run-6.png" class="img-fluid" width="420" loading="lazy">
    </p>
  </li>
  <li>
    <p>sss</p>
    <p>
      <img src="/en/books/essentials/tutorials/wisdom-for-sale/reach-run-7.png" class="img-fluid" width="420" loading="lazy">
    </p>
  </li>
</ol>
<h2 id="review-build-files">Review build files</h2>
<p>You see the following directory and files appear. Some files disappear.</p>
<ul>
  <li>build/index.main.mjs</li>
  <li>.dockerignore</li>
  <li>.gitignore</li>
  <li>Dockerfile</li>
  <li>package.json</li>
</ul>
<p>Understand significance.</p>
<p>Explain <code>reach scaffold</code>.</p>
<h1 id="pass-arguments">Pass arguments</h1>
<p>This section represents the first change that the developer makes to the project.</p>
<p>Replace <code>const role = 'seller';</code> with the following:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">if</span><span style="color: #24292E"> (process.argv.</span><span style="color: #005CC5">length</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E"> </span><span style="color: #D73A49">||</span><span style="color: #24292E"> [</span><span style="color: #032F62">'seller'</span><span style="color: #24292E">, </span><span style="color: #032F62">'buyer'</span><span style="color: #24292E">].</span><span style="color: #6F42C1">includes</span><span style="color: #24292E">(process.argv[</span><span style="color: #005CC5">2</span><span style="color: #24292E">]) </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">) {</span></li><li value="2"><span style="color: #24292E">  console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">'Usage: reach run index [seller|buyer]'</span><span style="color: #24292E">);</span></li><li value="3"><span style="color: #24292E">  process.</span><span style="color: #6F42C1">exit</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></li><li value="4"><span style="color: #24292E">}</span></li><li value="5"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">role</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> process.argv[</span><span style="color: #005CC5">2</span><span style="color: #24292E">];</span></li></ol></pre>
<h2 id="run-in-two-terminals">Run in two terminals</h2>
<p>Open two terminals (i.e. shells) positioned side by side.</p>
<p>Change directory in both to <code>~/reach/wisdom-for-sale/current</code>.</p>
<p>The left terminal is the <em>Seller Terminal</em>. In this terminal, run one of the following:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ REACH_CONNECTOR_MODE=ALGO-devnet reach run index seller</li><li value="2">$ REACH_CONNECTOR_MODE=ETH-devnet reach run index seller</li><li value="3">$ REACH_CONNECTOR_MODE=CFX-devnet reach run index seller</li></ol></pre>
<p>The right terminal is the <em>Buyer Terminal</em>. In this terminal, run the corresponding command:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ REACH_CONNECTOR_MODE=ALGO-devnet reach run index buyer</li><li value="2">$ REACH_CONNECTOR_MODE=ETH-devnet reach run index buyer</li><li value="3">$ REACH_CONNECTOR_MODE=CFX-devnet reach run index buyer</li></ol></pre>
<p>Try all of them if you like. Use these two terminal for the rest of the tutorial.</p>
<h2 id="about-adding-node-packages">About adding Node packages</h2>
<p>Explain that <code>reach scaffold</code> produces a <em>package.json</em> file useful for adding Node.js packages (e.g. <a href="https://www.npmjs.com/package/yargs">yargs</a>) not covered in this tutorial.</p>
<h2 id="environment-variable-limits">Environment variable Limits</h2>
<p>Discuss ways to pass information to Reach command-line apps. Setting an environment variable does not work. Explain why.</p>
<h1 id="use-the-reach-stdlib">Use the Reach Stdlib</h1>
<h2 id="review-current-usage">Review current usage</h2>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #24292E">stdlib.</span><span style="color: #6F42C1">connector</span><span style="color: #24292E">();</span></li><li value="2"><span style="color: #24292E">stdlib.</span><span style="color: #6F42C1">parseCurrency</span><span style="color: #24292E">();</span></li><li value="3"><span style="color: #24292E">stdlib.</span><span style="color: #6F42C1">newTestAccount</span><span style="color: #24292E">();</span></li></ol></pre>
<h2 id="inspect-stdlib">Inspect Stdlib</h2>
<p>Temporarily add the following just below <code>const stdlib = loadStdlib(process.env)</code>:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(stdlib);</span></li></ol></pre>
<p>Run the following in the Seller Terminal:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ reach run index seller &gt; output.txt</li></ol></pre>
<p>Inspect <em>output.txt</em> which displays Reach Stdlib properties, methods, and objects. Reach frontends and backends leverage this library. <a href="/en/books/essentials/support-for-js-frontends/">Support for JS Frontends</a> documents that portion of the library intended for frontends.</p>
<p>Remove the <code>console.log</code> statement.</p>
<h2 id="leverage-additional-methods">Leverage additional methods</h2>
<p>Add the following just below <code>const stdlib = loadStdlib(process.env)</code>:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">suStr</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> stdlib.standardUnit;</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #E36209">su</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">parseCurrency</span><span style="color: #24292E">(su);</span></li><li value="3"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toSU</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #E36209">au</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">formatCurrency</span><span style="color: #24292E">(au, </span><span style="color: #005CC5">4</span><span style="color: #24292E">);</span></li><li value="4"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">iBalance</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E">(</span><span style="color: #005CC5">1000</span><span style="color: #24292E">);</span></li><li value="5"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">async</span><span style="color: #24292E"> (</span><span style="color: #E36209">acc</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Your balance is ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #D73A49">await</span><span style="color: #032F62"> </span><span style="color: #24292E">stdlib</span><span style="color: #032F62">.</span><span style="color: #6F42C1">balanceOf</span><span style="color: #032F62">(</span><span style="color: #24292E">acc</span><span style="color: #032F62">))</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li></ol></pre>
<p>Explain each of these.</p>
<p>Replace <code>stdlib.parseCurrency(1000)</code> with <code>iBalance</code>.</p>
<p>Add <code>showBalance</code> in two places like this:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">acc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">newTestAccount</span><span style="color: #24292E">(iBalance);</span></li><li value="2"><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E">(acc);</span></li><li value="3"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">ctc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> acc.</span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">(backend);</span></li><li value="4"><span style="color: #D73A49">await</span><span style="color: #24292E"> backend.</span><span style="color: #6F42C1">Seller</span><span style="color: #24292E">(ctc, {});</span></li><li value="5"><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E">(acc);</span></li></ol></pre>
<p>Run the app in the Seller Terminal. Here is the output:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1">The consensus network is ETH.</li><li value="2">Your role is seller.</li><li value="3">Your balance is 1000 ETH.</li><li value="4">Your balance is 1000 ETH.</li></ol></pre>
<h1 id="add-seller-interact">Add seller interact</h1>
<h2 id="add-seller-frontend-interact">Add seller frontend interact</h2>
<p>Add an interact object to <em>index.mjs</em> for the seller.</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #6A737D">// SELLER INTERACT</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sellerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="3"><span style="color: #24292E">  price: </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E">(</span><span style="color: #005CC5">5</span><span style="color: #24292E">),</span></li><li value="4"><span style="color: #24292E">  wisdom: </span><span style="color: #032F62">'Scatter sunshine.'</span><span style="color: #24292E">,</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #6F42C1">reportReady</span><span style="color: #24292E">: </span><span style="color: #D73A49">async</span><span style="color: #24292E"> (</span><span style="color: #E36209">price</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="6"><span style="color: #24292E">    console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Your wisdom is for sale at ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #24292E">price</span><span style="color: #032F62">)</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li><li value="7"><span style="color: #24292E">    console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Contract info for buyer: ${</span><span style="color: #D73A49">await</span><span style="color: #032F62"> </span><span style="color: #24292E">ctc</span><span style="color: #032F62">.</span><span style="color: #6F42C1">getInfo</span><span style="color: #032F62">()</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li><li value="8"><span style="color: #24292E">  }</span></li><li value="9"><span style="color: #24292E">};</span></li></ol></pre>
<p>Replace <code>await backend.Seller(ctc, {})</code> with <code>await backend.Seller(ctc, sellerInteract);</code>.</p>
<h2 id="add-seller-backend-interact">Add seller backend interact</h2>
<p>Add a corresponding interact object to <em>index.rsh</em> for the seller.</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #6A737D">// SELLER INTERACT</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sellerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="3"><span style="color: #24292E">  price: UInt,</span></li><li value="4"><span style="color: #24292E">  wisdom: </span><span style="color: #6F42C1">Bytes</span><span style="color: #24292E">(</span><span style="color: #005CC5">128</span><span style="color: #24292E">),</span></li><li value="5"><span style="color: #24292E">  reportReady: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([UInt], Null)</span></li><li value="6"><span style="color: #24292E">};</span></li></ol></pre>
<p>Replace <code>const S = Participant('Seller', {})</code> with <code>const S = Participant('Seller', sellerInteract)</code>.</p>
<h2 id="add-seller-local-step">Add seller local step</h2>
<p>Add a local step for seller:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">only</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">price</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">declassify</span><span style="color: #24292E">(interact.price); });</span></li><li value="2"><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">(price);</span></li><li value="3"><span style="color: #005CC5">S</span><span style="color: #24292E">.interact.</span><span style="color: #6F42C1">reportReady</span><span style="color: #24292E">(price);</span></li><li value="4"><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li></ol></pre>
<h2 id="test-seller-interact">Test seller interact</h2>
<p>Run in the Seller Terminal:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1">The consensus network is ETH.</li><li value="2">Your role is seller.</li><li value="3">Your balance is 1000 ETH.</li><li value="4">Your wisdom is for sale at 5 ETH.</li><li value="5">Contract info for buyer: 0xbBD687F2cCa8AC0cB4c51ff0Da9632eF32aC1F7D.</li><li value="6">Your balance is 999.9998 ETH.</li></ol></pre>
<h1 id="add-buyer-interact">Add buyer interact</h1>
<h2 id="add-buyer-frontend-interact">Add buyer frontend interact</h2>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #6A737D">// BUYER INTERACT</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">buyerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="3"><span style="color: #24292E">  </span><span style="color: #6F42C1">confirmPurchase</span><span style="color: #24292E">: </span><span style="color: #D73A49">async</span><span style="color: #24292E"> (</span><span style="color: #E36209">price</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(</span><span style="color: #032F62">`Do you want to purchase wisdom for ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #24292E">price</span><span style="color: #032F62">)</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">} (y/n)?`</span><span style="color: #24292E">, yesno)</span></li><li value="4"><span style="color: #24292E">};</span></li></ol></pre>
<pre class="snippet numbered"><ol class="snippet"><li value="1">const acc = await stdlib.newTestAccount(iBalance);</li><li value="2">const info = await ask('Paste contract info:', (s) =&gt; s);</li><li value="3">const ctc = acc.attach(backend, info);</li><li value="4">await showBalance(acc);</li><li value="5">await backend.Buyer(ctc, buyerInteract);</li><li value="6">await showBalance(acc);</li></ol></pre>
<h2 id="add-buyer-backend-interact">Add buyer backend interact</h2>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #6A737D">// BUYER INTERACT</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">buyerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="3"><span style="color: #24292E">  confirmPurchase: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([UInt], Bool)</span></li><li value="4"><span style="color: #24292E">};</span></li></ol></pre>
<p>Replace <code>const B = Participant('Buyer', {})</code> with <code>const B = Participant('Buyer', buyerInteract)</code>.</p>
<h2 id="add-buyer-local-step">Add buyer local step</h2>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #005CC5">B</span><span style="color: #24292E">.</span><span style="color: #6F42C1">only</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">willBuy</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">declassify</span><span style="color: #24292E">(interact.</span><span style="color: #6F42C1">confirmPurchase</span><span style="color: #24292E">(price));</span></li><li value="3"><span style="color: #24292E">});</span></li><li value="4"><span style="color: #005CC5">B</span><span style="color: #24292E">.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">(willBuy);</span></li><li value="5"></li><li value="6"><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">willBuy) {</span></li><li value="7"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="8"><span style="color: #24292E">} </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></li><li value="9"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="10"><span style="color: #24292E">}</span></li></ol></pre>
<h2 id="test-buyer-interact">Test buyer interact</h2>
<p>Run both the seller and buyer roles. Copy the contract information from the Seller Terminal to the Buyer Terminal.</p>
<h1 id="add-common-interact">Add common interact</h1>
<h2 id="add-common-frontend-interact">Add common frontend interact</h2>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #6A737D">// COMMON INTERACT</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">commonInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="3"><span style="color: #24292E">  </span><span style="color: #6F42C1">reportCancellation</span><span style="color: #24292E">: () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">'The buyer cancelled the order.'</span><span style="color: #24292E">); }</span></li><li value="4"><span style="color: #24292E">};</span></li></ol></pre>
<p>Add a <code>...commonInteract,</code> property to <code>sellerInteract</code> and <code>buyerInteract</code>.</p>
<h2 id="add-common-backend-interact">Add common backend interact</h2>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #6A737D">// COMMON INTERACT</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">commonInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="3"><span style="color: #24292E">  reportCancellation: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([], Null)</span></li><li value="4"><span style="color: #24292E">};</span></li></ol></pre>
<p>Add a <code>...commonInteract,</code> property to <code>sellerInteract</code> and <code>buyerInteract</code>.</p>
<h2 id="add-willbuy-conditional">Add willBuy conditional</h2>
<p>Modify the <code>if</code> statement:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">willBuy) {</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="3"><span style="color: #24292E">  </span><span style="color: #6F42C1">each</span><span style="color: #24292E">([</span><span style="color: #005CC5">S</span><span style="color: #24292E">, </span><span style="color: #005CC5">B</span><span style="color: #24292E">], () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> interact.</span><span style="color: #6F42C1">reportCancellation</span><span style="color: #24292E">());</span></li><li value="4"><span style="color: #24292E">  </span><span style="color: #6F42C1">exit</span><span style="color: #24292E">();</span></li><li value="5"><span style="color: #24292E">} </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></li><li value="6"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="7"><span style="color: #24292E">}</span></li></ol></pre>
<h2 id="test-common-interact">Test common interact</h2>
<p>Run both the seller and buyer roles. When prompted, cancel the transaction.</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1">The buyer cancelled the order.</li></ol></pre>
<h2 id="add-who-and-retest">Add "who" and retest</h2>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">commonInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #E36209">who</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> ({</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #6F42C1">reportCancellation</span><span style="color: #24292E">: () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`${</span><span style="color: #24292E">who</span><span style="color: #032F62"> </span><span style="color: #D73A49">==</span><span style="color: #032F62"> </span><span style="color: #032F62">'buyer'</span><span style="color: #032F62"> </span><span style="color: #D73A49">?</span><span style="color: #032F62"> </span><span style="color: #032F62">'You'</span><span style="color: #032F62"> </span><span style="color: #D73A49">:</span><span style="color: #032F62"> </span><span style="color: #032F62">'The buyer'} cancelled the order.`</span><span style="color: #24292E">); }</span></li><li value="3"><span style="color: #24292E">});</span></li></ol></pre>
<p>Add a <code>...commonInteract(role),</code> property to <code>sellerInteract</code> and <code>buyerInteract</code>.</p>
<p>Retest.</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1">You cancelled the order.</li></ol></pre>
<h1 id="complete-the-transaction">Complete the transaction</h1>
<h2 id="modify-frontend-common-interact">Modify frontend common interact</h2>
<pre class="snippet numbered"><ol class="snippet"><li value="1">const commonInteract = (who) =&gt; ({</li><li value="2">  reportPayment: (payment) =&gt; console.log(`${who == 'buyer' ? 'You' : 'The buyer'} paid ${toSU(payment)} ${suStr} to the contract.`),</li><li value="3">  reportTransfer: (payment) =&gt; console.log(`The contract paid ${toSU(payment)} ${suStr} to ${who == 'seller' ? 'you' : 'the seller'}.`),</li><li value="4">  reportCancellation: () =&gt; { console.log(`${who == 'buyer' ? 'You' : 'The buyer'} cancelled the order.`); }</li><li value="5">});</li></ol></pre>
<h2 id="modify-backend-common-interact">Modify backend common interact</h2>
<pre class="snippet numbered"><ol class="snippet"><li value="1">const commonInteract = {</li><li value="2">  reportPayment: Fun([UInt], Null),</li><li value="3">  reportTransfer: Fun([UInt], Null),</li><li value="4">  reportCancellation: Fun([], Null)</li><li value="5">};</li></ol></pre>
<h2 id="add-pay-and-transfer-steps">Add pay and transfer steps</h2>
<pre class="snippet numbered"><ol class="snippet"><li value="1">B.pay(price);</li><li value="2">each([S, B], () =&gt; interact.reportPayment(price));</li><li value="3">commit();</li><li value="4"></li><li value="5">S.only(() =&gt; { const wisdom = declassify(interact.wisdom); });</li><li value="6">S.publish(wisdom);</li><li value="7">transfer(price).to(S);</li><li value="8">commit();</li><li value="9"></li><li value="10">each([S, B], () =&gt; interact.reportTransfer(price));</li><li value="11">B.interact.reportWisdom(wisdom);</li></ol></pre>
<h2 id="test-pay-and-transfer-steps">Test pay and transfer steps</h2>