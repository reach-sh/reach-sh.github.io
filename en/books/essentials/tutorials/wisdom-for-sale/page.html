<p>This tutorial introduces you to Reach DApp development and prepares you for more advanced Reach tutorials and projects. It is primarily task-based, but it includes several <em>Information</em> buttons throughout. Be sure to complete <a href="/en/books/essentials/quick-start/">Quick Start</a> and <a href="/en/books/essentials/developer-environment/">Development Environment</a> before proceeding.</p>
<h1 id="overview">Overview</h1>
<p>During this tutorial, you will build command-line and webapp versions of <a href="https://github.com/hagenhaus/wisdom-for-sale">Wisdom for Sale</a>, an application that enables two participants, a seller and a buyer, to trade wisdom for currency via a smart contract running on a private Algorand, Ethereum, or Conflux consensus network (e.g. devnet) residing in a Docker container on your computer. Your DApp will create and fund two accounts, one for each participant. Then, it will enable the seller and buyer to make a deal.</p>
<div class="d-grid"><button class="btn btn-secondary btn-sm text-start" type="button" data-bs-toggle="collapse" data-bs-target="#deal" aria-expanded="false"><i class="fas fa-info-circle me-2"></i><span>Seller-Buyer Diagram</span></button></div><span class="collapse" id="deal"><p>The following diagram represents the wisdom-for-sale deal.</p><div>
    <img src="/en/books/essentials/tutorials/wisdom-for-sale/seller-buyer.png" class="img-fluid my-4 d-block" width="800" height="317" loading="lazy">
  </div><p>This particular transaction took place on an Ethereum devnet. The Ethereum cryptocurrency standard token unit is the <em>Ether</em> or <em>ETH</em>. The tutorial also allows you to perform this transaction on an Algorand or Conflux devnet. The Algorand standard unit is the <em>ALGO</em>, and the Conflux standard unit is the <em>CFX</em>. As indicated by the final balances in the diagram, the seller received 0.0019 ETH less than the agreed upon price, and the buyer paid 0.0003 ETH more. These expenses represent <em>gas</em>, the cost of doing business on a consensus network. The seller paid a little more gas than the buyer because the seller deployed the contract.</p><hr style="background-color:#6c757d;opacity:1;height:5px;"></span>
<p>Creating a Reach DApp does <em>not</em> entail implementing a smart contract. Rather, it involves using the Reach programming language to describe, step by step, participant interactions from which the Reach compiler derives a smart contract.</p>
<div class="d-grid"><button class="btn btn-secondary btn-sm text-start" type="button" data-bs-toggle="collapse" data-bs-target="#stf" aria-expanded="false"><i class="fas fa-info-circle me-2"></i><span>Develop &amp; Deploy Video</span></button></div><span class="collapse" id="stf"><p>This video provides a mental framework for understanding Reach development and deployment.</p><p class="ratio ratio-16x9 my-4" style="max-width:500px;">
    <iframe src="https://www.youtube.com/embed/4MJqPNelqCE" frameborder="0" allowfullscreen=""></iframe>
  </p><p>Mentioned in the video are (1) the Reach <a href="/en/books/essentials/support-for-js-frontends/">JavaScript Standard Library</a> which supports Reach applications by providing properties and methods dealing with accounts, arithmetic, big numbers, comparisons, consensus network providers, contracts, debugging, encryption, randomization, and time, (2) interact objects which are JavaScript objects that enable communication between Reach frontends and backends, explained in detail below, and (3) the Reach Verification Engine which helps to ensure that the immutable smart contract you deploy will run without errors like the error of forgetting to transfer all the otherwise unretrievable tokens out of a smart contract account before the contract exits.</p><hr style="background-color:#6c757d;opacity:1;height:5px;"></span>
<h1 id="clone-the-repository">Clone the repository</h1>
<p>Be sure to complete <a href="/en/books/essentials/quick-start/">Quick Start</a> and <a href="/en/books/essentials/developer-environment/">Development Environment</a> before proceeding.</p>
<ol>
  <li>
    <p>Clone the <a href="https://github.com/hagenhaus/wisdom-for-sale">wisdom-for-sale</a> repository:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ cd ~/reach</li><li value="2">$ git clone https://github.com/hagenhaus/wisdom-for-sale.git</li></ol></pre>
  </li>
  <li>
    <p>Open the repository in vscode.</p>
    <p>
      <img src="/en/books/essentials/tutorials/wisdom-for-sale/vscode-initial.png" class="img-fluid" width="700" loading="lazy">
    </p>
  </li>
  <li>
    <p>Copy <em>index.mjs</em> and <em>index.rsh</em> from the <em>starter</em> folder to the <em>current</em> folder, and open both files.</p>
  </li>
</ol>
<div class="d-grid"><button class="btn btn-secondary btn-sm text-start" type="button" data-bs-toggle="collapse" data-bs-target="#rsf" aria-expanded="false"><i class="fas fa-info-circle me-2"></i><span>Review Starter Files</span></button></div><span class="collapse" id="rsf"><p><strong>index.mjs</strong></p><pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">import</span><span style="color: #24292E"> { loadStdlib } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'@reach-sh/stdlib'</span><span style="color: #24292E">;</span></li><li value="2"><span style="color: #D73A49">import</span><span style="color: #24292E"> </span><span style="color: #005CC5">*</span><span style="color: #24292E"> </span><span style="color: #D73A49">as</span><span style="color: #24292E"> backend </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'./build/index.main.mjs'</span><span style="color: #24292E">;</span></li><li value="3"><span style="color: #D73A49">import</span><span style="color: #24292E"> { ask, yesno, done } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'@reach-sh/stdlib/ask.mjs'</span><span style="color: #24292E">;</span></li><li value="4"></li><li value="5"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">stdlib</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">loadStdlib</span><span style="color: #24292E">(process.env);</span></li><li value="6"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`The consensus network is ${</span><span style="color: #24292E">stdlib</span><span style="color: #032F62">.</span><span style="color: #24292E">connector</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li><li value="7"></li><li value="8"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">role</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">'seller'</span><span style="color: #24292E">;</span></li><li value="9"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Your role is ${</span><span style="color: #24292E">role</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li><li value="10"></li><li value="11"><span style="color: #24292E">(</span><span style="color: #D73A49">async</span><span style="color: #24292E"> () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="12"></li><li value="13"><span style="color: #24292E">  </span><span style="color: #6A737D">// SELLER</span></li><li value="14"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (role </span><span style="color: #D73A49">===</span><span style="color: #24292E"> </span><span style="color: #032F62">'seller'</span><span style="color: #24292E">) {</span></li><li value="15"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">acc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">newTestAccount</span><span style="color: #24292E">(stdlib.</span><span style="color: #6F42C1">parseCurrency</span><span style="color: #24292E">(</span><span style="color: #005CC5">1000</span><span style="color: #24292E">));</span></li><li value="16"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">ctc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> acc.</span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">(backend);</span></li><li value="17"><span style="color: #24292E">    </span><span style="color: #D73A49">await</span><span style="color: #24292E"> backend.</span><span style="color: #6F42C1">Seller</span><span style="color: #24292E">(ctc, {});</span></li><li value="18"><span style="color: #24292E">  }</span></li><li value="19"></li><li value="20"><span style="color: #24292E">  </span><span style="color: #6A737D">// BUYER</span></li><li value="21"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></li><li value="22"><span style="color: #24292E">  }</span></li><li value="23"></li><li value="24"><span style="color: #24292E">  </span><span style="color: #6F42C1">done</span><span style="color: #24292E">();</span></li><li value="25"><span style="color: #24292E">})();</span></li></ol></pre><p>Below is a line-by-line description:</p><ul>
    <li>Line 1: Import the Reach JS Standard Library loader.</li>
    <li>Line 2: Import the JS backend compiled from index.rsh.</li>
    <li>Line 3: Import a Reach Node.js package to help with command-line i/o.</li>
    <li>Line 5: Load the Reach JS Stdlib for the consensus network specified by the <code>REACH_CONNECTOR_MODE</code>.</li>
    <li>Line 6: Display the consensus network type.</li>
    <li>Line 8: Hard-code the role. You will change this later.</li>
    <li>Line 9: Display the role.</li>
    <li>Line 11: Enable enclosed code to await the fulfillment of promises.</li>
    <li>Line 14: Code for when you run this app as the seller.</li>
    <li>Line 15: Create an account for the seller. <em>parseCurrency</em> transforms units from standard to atomic.</li>
    <li>Line 16: Get a reference to the contract.</li>
    <li>Line 17: Call <code>Seller(ctc, interact)</code> in <em>index.main.mjs</em> which deploys the contract.</li>
    <li>Line 24: Tell <em>ask.mjs</em> that you are finished.</li>
  </ul><p><strong>index.rsh</strong></p><pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #032F62">'reach 0.1'</span><span style="color: #24292E">;</span></li><li value="2"></li><li value="3"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">main</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Reach.</span><span style="color: #6F42C1">App</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="4"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">S</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Seller'</span><span style="color: #24292E">, {});</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">B</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Buyer'</span><span style="color: #24292E">, {});</span></li><li value="6"><span style="color: #24292E">  </span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">();</span></li><li value="7"></li><li value="8"><span style="color: #24292E">  </span><span style="color: #6F42C1">exit</span><span style="color: #24292E">();</span></li><li value="9"><span style="color: #24292E">});</span></li></ol></pre><p>Below is a line-by-line description:</p><ul>
    <li>Line 1: Instruction to the compiler.</li>
    <li>Line 3: Reach standard application initialization.</li>
    <li>Line 4: Define a constant to represent the seller. The <code>{}</code> indicates an empty interact object.</li>
    <li>Line 5: Define a constant to represent the buyer. Same.</li>
    <li>Line 6: Finalize participant and other options.</li>
    <li>Line 8: Terminate computation.</li>
  </ul><hr style="background-color:#6c757d;opacity:1;height:5px;"></span>
<h1 id="run-the-app">Run the app</h1>
<p>Run your starter app in the vscode terminal three times, once for each supported consensus network, using the commands below in succession:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ REACH_CONNECTOR_MODE=ALGO-devnet reach run</li><li value="2">$ REACH_CONNECTOR_MODE=ETH-devnet reach run</li><li value="3">$ REACH_CONNECTOR_MODE=CFX-devnet reach run</li></ol></pre>
<p>
  <img src="/en/books/essentials/tutorials/wisdom-for-sale/vscode-run.png" class="img-fluid" width="700" loading="lazy">
</p>
<p>In your current environment, most executables -- the Reach Compiler, the consensus network devnets, your application, and the smart contract -- run in Docker containers instantiated from Reach Docker images.</p>
<div class="d-grid"><button class="btn btn-secondary btn-sm text-start" type="button" data-bs-toggle="collapse" data-bs-target="#ebp" aria-expanded="false"><i class="fas fa-info-circle me-2"></i><span>Explore Build Output</span></button></div><span class="collapse" id="ebp"><p>Here is sample output:</p><pre class="snippet numbered"><ol class="snippet"><li value="1">current % REACH_CONNECTOR_MODE=ALGO-devnet reach run</li><li value="2">Verifying knowledge assertions</li><li value="3">Verifying for generic connector</li><li value="4">  Verifying when ALL participants are honest</li><li value="5">  Verifying when NO participants are honest</li><li value="6">  Verifying when ONLY "Buyer" is honest</li><li value="7">  Verifying when ONLY "Seller" is honest</li><li value="8">Checked 4 theorems; No failures!</li><li value="9">[+] Building 0.2s (7/7) FINISHED</li><li value="10"> =&gt; [internal] load build definition from Dockerfile                                         0.0s</li><li value="11"> =&gt; =&gt; transferring dockerfile: 234B                                                         0.0s</li><li value="12"> =&gt; [internal] load .dockerignore                                                            0.0s</li><li value="13"> =&gt; =&gt; transferring context: 75B                                                             0.0s</li><li value="14"> =&gt; [internal] load metadata for docker.io/reachsh/runner:0.1.5                              0.0s</li><li value="15"> =&gt; [internal] load build context                                                            0.0s</li><li value="16"> =&gt; =&gt; transferring context: 4.60kB                                                          0.0s</li><li value="17"> =&gt; CACHED [1/2] FROM docker.io/reachsh/runner:0.1.5                                         0.0s</li><li value="18"> =&gt; [2/2] COPY . /app                                                                        0.0s</li><li value="19"> =&gt; exporting to image                                                                       0.0s</li><li value="20"> =&gt; =&gt; exporting layers                                                                      0.0s</li><li value="21"> =&gt; =&gt; writing image sha256:13e69eb72504bbc85074476e5d1183b6ad2734a5eabc9e56c2138023d64a507a 0.0s</li><li value="22"> =&gt; =&gt; naming to docker.io/reachsh/reach-app-current:latest                                  0.0s</li><li value="23"></li><li value="24">Use 'docker scan' to run Snyk tests against images to find vulnerabilities and learn how to fix them</li><li value="25">Creating reach2021-10-13t14-26-55z-vcv1_reach-app-current_run ... done</li><li value="26"></li><li value="27">&gt; @reach-sh/current@ index /app</li><li value="28">&gt; node --experimental-modules --unhandled-rejections=strict index.mjs</li><li value="29"></li><li value="30">The consensus network is ALGO.</li><li value="31">Your role is seller.</li></ol></pre><p>Below is a line-by-line description:</p><ul>
    <li>
      <p>Line 1: The Reach Compiler inputs <em>reach.rsh</em>.</p>
      <p>
        <img src="/en/books/essentials/tutorials/wisdom-for-sale/reach-run-2.png" class="img-fluid" width="420" loading="lazy">
      </p>
      <p>And, it outputs <em>index.main.mjs</em> consisting of the compiled backend (blue) and the smart contract (dark orange):</p>
      <p>
        <img src="/en/books/essentials/tutorials/wisdom-for-sale/reach-run-3.png" class="img-fluid" width="420" loading="lazy">
      </p>
    </li>
    <li>
      <p>Line 2: The Reach Verification Engine validates the smart contract:</p>
      <p>
        <img src="/en/books/essentials/tutorials/wisdom-for-sale/reach-run-4.png" class="img-fluid" width="420" loading="lazy">
      </p>
    </li>
    <li>
      <p>Lines 10-22: The process builds a Docker image for your application.</p>
      <p>
        <img src="/en/books/essentials/tutorials/wisdom-for-sale/reach-run-5.png" class="img-fluid" width="420" loading="lazy">
      </p>
      <p>Note the mention of <em>Dockerfile</em> and <em>.dockerignore</em>. The <code>reach run</code> command creates the following set of files, deleting all but <em>index.main.mjs</em> on completion:</p>
      <pre class="snippet unnumbered"><ol class="snippet"><li value="1">build/index.main.mjs</li><li value="2">.dockerignore</li><li value="3">.gitignore</li><li value="4">Dockerfile</li><li value="5">package.json</li></ol></pre>
      <p>For some of your Reach projects, you may find it useful to retain and edit these files, especially <em>package.json</em>. To create and retain these files, run <code>reach scaffold</code> before running <code>reach run</code>.</p>
    </li>
    <li>
      <p>Line 24: The process checks the new image for vulnerabilities.</p>
      <p>
        <img src="/en/books/essentials/tutorials/wisdom-for-sale/reach-run-6.png" class="img-fluid" width="420" loading="lazy">
      </p>
    </li>
    <li>
      <p>Line 27: The process runs your app in a container built from the image.</p>
      <p>
        <img src="/en/books/essentials/tutorials/wisdom-for-sale/reach-run-7.png" class="img-fluid" width="420" loading="lazy">
      </p>
    </li>
    <li>
      <p>Line 30-31: Your application outputs these messages.</p>
    </li>
  </ul><hr style="background-color:#6c757d;opacity:1;height:5px;"></span>
<h1 id="pass-role-as-argument">Pass role as argument</h1>
<p>Modify the starter app to accept a command-line argument specifying whether to run as the seller or buyer. Although this change does not involve Reach directly, it does emphasize that your application represents two different participants negotiating via the same contract.</p>
<ol>
  <li>
    <p>In <em>index.mjs</em>, replace <code>const role = 'seller';</code> with the following:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">if</span><span style="color: #24292E"> (process.argv.</span><span style="color: #005CC5">length</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E"> </span><span style="color: #D73A49">||</span><span style="color: #24292E"> [</span><span style="color: #032F62">'seller'</span><span style="color: #24292E">, </span><span style="color: #032F62">'buyer'</span><span style="color: #24292E">].</span><span style="color: #6F42C1">includes</span><span style="color: #24292E">(process.argv[</span><span style="color: #005CC5">2</span><span style="color: #24292E">]) </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">) {</span></li><li value="2"><span style="color: #24292E">  console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">'Usage: reach run index [seller|buyer]'</span><span style="color: #24292E">);</span></li><li value="3"><span style="color: #24292E">  process.</span><span style="color: #6F42C1">exit</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></li><li value="4"><span style="color: #24292E">}</span></li><li value="5"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">role</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> process.argv[</span><span style="color: #005CC5">2</span><span style="color: #24292E">];</span></li></ol></pre>
  </li>
  <li>
    <p>Open two terminals (i.e. shells), and change directory in both to <code>~/reach/wisdom-for-sale/current</code>:</p>
    <p>
      <img src="/en/books/essentials/tutorials/wisdom-for-sale/terminals-empty.png" class="img-fluid" width="700" loading="lazy">
    </p>
    <p>The left terminal is the <em>Seller Terminal</em>, and the right is the <em>Buyer Terminal</em>.</p>
  </li>
  <li>
    <p>In the Seller Terminal, run one of the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ REACH_CONNECTOR_MODE=ALGO-devnet reach run index seller</li><li value="2">$ REACH_CONNECTOR_MODE=ETH-devnet reach run index seller</li><li value="3">$ REACH_CONNECTOR_MODE=CFX-devnet reach run index seller</li></ol></pre>
    <p>When you pass arguments to <code>reach run</code>, the first one must be the name of the <code>index.rsh</code> file without the extension (i.e. <code>index</code>). Application output should be the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">The consensus network is ALGO|ETH|CFX.</li><li value="2">Your role is seller.</li></ol></pre>
  </li>
  <li>
    <p>In the Buyer Terminal, run the corresponding command (one of the following):</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ REACH_CONNECTOR_MODE=ALGO-devnet reach run index buyer</li><li value="2">$ REACH_CONNECTOR_MODE=ETH-devnet reach run index buyer</li><li value="3">$ REACH_CONNECTOR_MODE=CFX-devnet reach run index buyer</li></ol></pre>
    <p>Output:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">The consensus network is ALGO|ETH|CFX.</li><li value="2">Your role is buyer.</li></ol></pre>
  </li>
  <li>
    <p>Repeat for the other consensus networks.</p>
  </li>
</ol>
<p>You can, instead, use a Node.js package like <a href="https://www.npmjs.com/package/minimist">Minimist</a>, <a href="https://www.npmjs.com/package/commander">Commander</a>, <a href="https://www.npmjs.com/package/meow">Meow</a>, <a href="https://www.npmjs.com/package/yargs">Yargs</a>, or <a href="https://www.npmjs.com/package/vorpal">Vorpal</a>.</p>
<div class="d-grid"><button class="btn btn-secondary btn-sm text-start" type="button" data-bs-toggle="collapse" data-bs-target="#npi" aria-expanded="false"><i class="fas fa-info-circle me-2"></i><span>Node Package Integration</span></button></div><span class="collapse" id="npi"><p>Not done yet.</p><hr style="background-color:#6c757d;opacity:1;height:5px;"></span>
<p>You cannot pass information to your Reach DApp via environment variables. The <a href="https://github.com/reach-sh/reach-lang/blob/master/reach">reach</a> script exports only a limited set of environment variables within the Docker container where it runs your app, so it does not support exporting <code>role</code> (e.g. <code>ROLE=seller reach run</code>) or any other custom value as an environment variable.</p>
<h1 id="use-the-reach-stdlib">Use the Reach Stdlib</h1>
<p>The Reach <a href="/en/books/essentials/support-for-js-frontends/">JavaScript Standard Library</a> supports Reach applications by providing properties and methods dealing with accounts, arithmetic, big numbers, comparisons, consensus network providers, contracts, debugging, encryption, randomization, and time.</p>
<ol>
  <li>
    <p>Add the following just below <code>const stdlib = loadStdlib(process.env)</code>:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">suStr</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> stdlib.standardUnit;</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #E36209">su</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">parseCurrency</span><span style="color: #24292E">(su);</span></li><li value="3"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toSU</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #E36209">au</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">formatCurrency</span><span style="color: #24292E">(au, </span><span style="color: #005CC5">4</span><span style="color: #24292E">);</span></li><li value="4"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">iBalance</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E">(</span><span style="color: #005CC5">1000</span><span style="color: #24292E">);</span></li><li value="5"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">async</span><span style="color: #24292E"> (</span><span style="color: #E36209">acc</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Your balance is ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #D73A49">await</span><span style="color: #032F62"> </span><span style="color: #24292E">stdlib</span><span style="color: #032F62">.</span><span style="color: #6F42C1">balanceOf</span><span style="color: #032F62">(</span><span style="color: #24292E">acc</span><span style="color: #032F62">))</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li></ol></pre>
  </li>
  <li>
    <p>Find Line 1 below and change it to Line 2:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">acc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">newTestAccount</span><span style="color: #24292E">(stdlib.</span><span style="color: #6F42C1">parseCurrency</span><span style="color: #24292E">(</span><span style="color: #005CC5">1000</span><span style="color: #24292E">));</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">acc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">newTestAccount</span><span style="color: #24292E">(iBalance);</span></li></ol></pre>
  </li>
  <li>
    <p>Add <code>showBalance</code> in two places like this:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">if</span><span style="color: #24292E"> (role </span><span style="color: #D73A49">===</span><span style="color: #24292E"> </span><span style="color: #032F62">'seller'</span><span style="color: #24292E">) {</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">acc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">newTestAccount</span><span style="color: #24292E">(iBalance);</span></li><li value="3"><span style="color: #24292E">  </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E">(acc);</span></li><li value="4"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">ctc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> acc.</span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">(backend);</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #D73A49">await</span><span style="color: #24292E"> backend.</span><span style="color: #6F42C1">Seller</span><span style="color: #24292E">(ctc, {});</span></li><li value="6"><span style="color: #24292E">  </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E">(acc);</span></li><li value="7"><span style="color: #24292E">}</span></li></ol></pre>
  </li>
  <li>
    <p>Run the app in the Seller Terminal.</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ REACH_CONNECTOR_MODE=ALGO-devnet reach run index seller</li></ol></pre>
    <p>Below is the output. Eventually, the two <code>Your balance</code> lines will display the seller's account balances before and after the transaction.</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">The consensus network is ALGO.</li><li value="2">Your role is seller.</li><li value="3">Your balance is 1000 ALGO.</li><li value="4">Your balance is 1000 ALGO.</li></ol></pre>
  </li>
</ol>
<p>Consensus network tokens are measured in (divisible) standard units and (indivisible) atomic units, and Reach apps often convert between the two.</p>
<div class="d-grid"><button class="btn btn-secondary btn-sm text-start" type="button" data-bs-toggle="collapse" data-bs-target="#ausu" aria-expanded="false"><i class="fas fa-info-circle me-2"></i><span>About toAU and toSU</span></button></div><span class="collapse" id="ausu"><p>Not done yet.</p><hr style="background-color:#6c757d;opacity:1;height:5px;"></span>
<h1 id="add-seller-interact-objects">Add seller interact objects</h1>
<ol>
  <li>
    <p>Add an interact object (Lines 4-12) to <em>index.mjs</em> for the seller:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #6A737D">// SELLER</span></li><li value="2"><span style="color: #D73A49">if</span><span style="color: #24292E"> (role </span><span style="color: #D73A49">===</span><span style="color: #24292E"> </span><span style="color: #032F62">'seller'</span><span style="color: #24292E">) {</span></li><li value="3"></li><li value="4"><span style="color: #24292E">  </span><span style="color: #6A737D">// SELLER INTERACT</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sellerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="6"><span style="color: #24292E">    price: </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E">(</span><span style="color: #005CC5">5</span><span style="color: #24292E">),</span></li><li value="7"><span style="color: #24292E">    wisdom: </span><span style="color: #032F62">'Scatter sunshine.'</span><span style="color: #24292E">,</span></li><li value="8"><span style="color: #24292E">    </span><span style="color: #6F42C1">reportReady</span><span style="color: #24292E">: </span><span style="color: #D73A49">async</span><span style="color: #24292E"> (</span><span style="color: #E36209">price</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="9"><span style="color: #24292E">      console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Your wisdom is for sale at ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #24292E">price</span><span style="color: #032F62">)</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li><li value="10"><span style="color: #24292E">      console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Contract info: ${</span><span style="color: #005CC5">JSON</span><span style="color: #032F62">.</span><span style="color: #005CC5">stringify</span><span style="color: #032F62">(</span><span style="color: #D73A49">await</span><span style="color: #032F62"> </span><span style="color: #24292E">ctc</span><span style="color: #032F62">.</span><span style="color: #6F42C1">getInfo</span><span style="color: #032F62">())</span><span style="color: #032F62">}`</span><span style="color: #24292E">);</span></li><li value="11"><span style="color: #24292E">    }</span></li><li value="12"><span style="color: #24292E">  };</span></li><li value="13"></li><li value="14"><span style="color: #24292E">  </span><span style="color: #D73A49">...</span></li><li value="15"><span style="color: #24292E">}</span></li></ol></pre>
  </li>
  <li>
    <p>Find Line 1 below and change it to Line 2:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">await</span><span style="color: #24292E"> backend.</span><span style="color: #6F42C1">Seller</span><span style="color: #24292E">(ctc, {});</span></li><li value="2"><span style="color: #D73A49">await</span><span style="color: #24292E"> backend.</span><span style="color: #6F42C1">Seller</span><span style="color: #24292E">(ctc, sellerInteract);</span></li></ol></pre>
  </li>
  <li>
    <p>Add a corresponding interact object (Lines 3-8) to <em>index.rsh</em> for the seller:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #032F62">'reach 0.1'</span><span style="color: #24292E">;</span></li><li value="2"></li><li value="3"><span style="color: #6A737D">// SELLER INTERACT</span></li><li value="4"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sellerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="5"><span style="color: #24292E">  price: UInt,</span></li><li value="6"><span style="color: #24292E">  wisdom: </span><span style="color: #6F42C1">Bytes</span><span style="color: #24292E">(</span><span style="color: #005CC5">128</span><span style="color: #24292E">),</span></li><li value="7"><span style="color: #24292E">  reportReady: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([UInt], Null)</span></li><li value="8"><span style="color: #24292E">};</span></li><li value="9"></li><li value="10"><span style="color: #D73A49">...</span></li></ol></pre>
  </li>
  <li>
    <p>Find Line 1 below and change it to Line 2:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">S</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Seller'</span><span style="color: #24292E">, {});</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">S</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Seller'</span><span style="color: #24292E">, sellerInteract);</span></li></ol></pre>
  </li>
  <li>
    <p>Add actions (Lines 3-6) for seller in <em>index.rsh</em>:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #24292E">  </span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">();</span></li><li value="2"></li><li value="3"><span style="color: #24292E">  </span><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">only</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">price</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">declassify</span><span style="color: #24292E">(interact.price); });</span></li><li value="4"><span style="color: #24292E">  </span><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">(price);</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #005CC5">S</span><span style="color: #24292E">.interact.</span><span style="color: #6F42C1">reportReady</span><span style="color: #24292E">(price);</span></li><li value="6"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="7"></li><li value="8"><span style="color: #24292E">  </span><span style="color: #6F42C1">exit</span><span style="color: #24292E">();</span></li></ol></pre>
  </li>
  <li>
    <p>Run in the Seller Terminal:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ REACH_CONNECTOR_MODE=ETH-devnet reach run index seller</li></ol></pre>
    <p>Output should resemble the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">The consensus network is ETH.</li><li value="2">Your role is seller.</li><li value="3">Your balance is 1000 ETH.</li><li value="4">Your wisdom is for sale at 5 ETH.</li><li value="5">Contract info for buyer: 0xbBD687F2cCa8AC0cB4c51ff0Da9632eF32aC1F7D.</li><li value="6">Your balance is 999.9998 ETH.</li></ol></pre>
  </li>
</ol>
<p>Interact objects facilitate communication between the frontend (i.e. <code>index.mjs</code>) and backend (i.e. <code>index.main.mjs</code>) of Reach applications. Recall that <code>index.rsh</code> is the pre-compiled version of <code>index.main.mjs</code>.</p>
<div class="d-grid"><button class="btn btn-secondary btn-sm text-start" type="button" data-bs-toggle="collapse" data-bs-target="#aio" aria-expanded="false"><i class="fas fa-info-circle me-2"></i><span>About Interact Objects</span></button></div><span class="collapse" id="aio"><p>Not done yet.</p><hr style="background-color:#6c757d;opacity:1;height:5px;"></span>
<p>Each Reach backend action (e.g. <code>declassify(interact.price)</code>) takes place within the context of a <em>local step</em>, <em>step</em>, or <em>consensus step</em>. Actions involving one participant take place within a <em>local step</em>. Those involving all participants take place within a <em>step</em>. Those involving the contract itself take place within a <em>consensus step</em>.</p>
<div class="d-grid"><button class="btn btn-secondary btn-sm text-start" type="button" data-bs-toggle="collapse" data-bs-target="#as" aria-expanded="false"><i class="fas fa-info-circle me-2"></i><span>About Steps</span></button></div><span class="collapse" id="as"><p>Not done yet.</p><hr style="background-color:#6c757d;opacity:1;height:5px;"></span>
<h1 id="add-buyer-interact-objects">Add buyer interact objects</h1>
<ol>
  <li>
    <p>Add an interact object and supporting code to <em>index.mjs</em> for the buyer:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #6A737D">// BUYER</span></li><li value="2"><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></li><li value="3"></li><li value="4"><span style="color: #24292E">  </span><span style="color: #6A737D">// BUYER INTERACT</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">buyerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="6"><span style="color: #24292E">    </span><span style="color: #6F42C1">confirmPurchase</span><span style="color: #24292E">: </span><span style="color: #D73A49">async</span><span style="color: #24292E"> (</span><span style="color: #E36209">price</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(</span><span style="color: #032F62">`Do you want to purchase wisdom for ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #24292E">price</span><span style="color: #032F62">)</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">} (y/n)?`</span><span style="color: #24292E">, yesno)</span></li><li value="7"><span style="color: #24292E">  };</span></li><li value="8"></li><li value="9"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">acc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">newTestAccount</span><span style="color: #24292E">(iBalance);</span></li><li value="10"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">info</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(</span><span style="color: #032F62">'Paste contract info:'</span><span style="color: #24292E">, (</span><span style="color: #E36209">s</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">JSON</span><span style="color: #24292E">.</span><span style="color: #005CC5">parse</span><span style="color: #24292E">(s));</span></li><li value="11"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">ctc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> acc.</span><span style="color: #6F42C1">attach</span><span style="color: #24292E">(backend, info);</span></li><li value="12"><span style="color: #24292E">  </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E">(acc);</span></li><li value="13"><span style="color: #24292E">  </span><span style="color: #D73A49">await</span><span style="color: #24292E"> backend.</span><span style="color: #6F42C1">Buyer</span><span style="color: #24292E">(ctc, buyerInteract);</span></li><li value="14"><span style="color: #24292E">  </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E">(acc);</span></li><li value="15"><span style="color: #24292E">}</span></li></ol></pre>
  </li>
  <li>
    <p>Add a corresponding interact object to <em>index.rsh</em> (under <code>sellerInteract</code>) for the buyer:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #6A737D">// BUYER INTERACT</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">buyerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="3"><span style="color: #24292E">  confirmPurchase: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([UInt], Bool)</span></li><li value="4"><span style="color: #24292E">};</span></li></ol></pre>
  </li>
  <li>
    <p>Find Line 1 below and change it to Line 2:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">S</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Buyer'</span><span style="color: #24292E">, {});</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">S</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Buyer'</span><span style="color: #24292E">, buyerInteract);</span></li></ol></pre>
  </li>
  <li>
    <p>Add actions for buyer in <em>index.rsh</em>:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #005CC5">B</span><span style="color: #24292E">.</span><span style="color: #6F42C1">only</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">willBuy</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">declassify</span><span style="color: #24292E">(interact.</span><span style="color: #6F42C1">confirmPurchase</span><span style="color: #24292E">(price));</span></li><li value="3"><span style="color: #24292E">});</span></li><li value="4"><span style="color: #005CC5">B</span><span style="color: #24292E">.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">(willBuy);</span></li><li value="5"></li><li value="6"><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">willBuy) {</span></li><li value="7"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="8"><span style="color: #24292E">} </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></li><li value="9"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="10"><span style="color: #24292E">}</span></li></ol></pre>
  </li>
  <li>
    <p>Run the app in the Seller Terminal and in the Buyer Terminal. The Buyer will prompt you to provide the contract info and to decide whether to purchase the wisdom. Answer <code>n</code> to the second prompt.</p>
  </li>
</ol>
<p>The seller creates the contract, retrieves a contract reference in the form of contract info, and makes the info available to the buyer who uses it to find and run the smart contract.</p>
<div class="d-grid"><button class="btn btn-secondary btn-sm text-start" type="button" data-bs-toggle="collapse" data-bs-target="#ci" aria-expanded="false"><i class="fas fa-info-circle me-2"></i><span>About Contract Info</span></button></div><span class="collapse" id="ci"><p>Not done yet.</p><hr style="background-color:#6c757d;opacity:1;height:5px;"></span>
<h1 id="add-common-interact">Add common interact</h1>
<h2 id="add-common-frontend-interact">Add common frontend interact</h2>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #6A737D">// COMMON INTERACT</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">commonInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="3"><span style="color: #24292E">  </span><span style="color: #6F42C1">reportCancellation</span><span style="color: #24292E">: () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">'The buyer cancelled the order.'</span><span style="color: #24292E">); }</span></li><li value="4"><span style="color: #24292E">};</span></li></ol></pre>
<p>Add a <code>...commonInteract,</code> property to <code>sellerInteract</code> and <code>buyerInteract</code>.</p>
<h2 id="add-common-backend-interact">Add common backend interact</h2>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #6A737D">// COMMON INTERACT</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">commonInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="3"><span style="color: #24292E">  reportCancellation: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([], Null)</span></li><li value="4"><span style="color: #24292E">};</span></li></ol></pre>
<p>Add a <code>...commonInteract,</code> property to <code>sellerInteract</code> and <code>buyerInteract</code>.</p>
<h2 id="add-willbuy-conditional">Add willBuy conditional</h2>
<p>Modify the <code>if</code> statement:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">willBuy) {</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="3"><span style="color: #24292E">  </span><span style="color: #6F42C1">each</span><span style="color: #24292E">([</span><span style="color: #005CC5">S</span><span style="color: #24292E">, </span><span style="color: #005CC5">B</span><span style="color: #24292E">], () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> interact.</span><span style="color: #6F42C1">reportCancellation</span><span style="color: #24292E">());</span></li><li value="4"><span style="color: #24292E">  </span><span style="color: #6F42C1">exit</span><span style="color: #24292E">();</span></li><li value="5"><span style="color: #24292E">} </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></li><li value="6"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="7"><span style="color: #24292E">}</span></li></ol></pre>
<h2 id="test-common-interact">Test common interact</h2>
<p>Run both the seller and buyer roles. When prompted, cancel the transaction.</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1">The buyer cancelled the order.</li></ol></pre>
<h2 id="add-who-and-retest">Add "who" and retest</h2>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">commonInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #E36209">who</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> ({</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #6F42C1">reportCancellation</span><span style="color: #24292E">: () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`${</span><span style="color: #24292E">who</span><span style="color: #032F62"> </span><span style="color: #D73A49">==</span><span style="color: #032F62"> </span><span style="color: #032F62">'buyer'</span><span style="color: #032F62"> </span><span style="color: #D73A49">?</span><span style="color: #032F62"> </span><span style="color: #032F62">'You'</span><span style="color: #032F62"> </span><span style="color: #D73A49">:</span><span style="color: #032F62"> </span><span style="color: #032F62">'The buyer'} cancelled the order.`</span><span style="color: #24292E">); }</span></li><li value="3"><span style="color: #24292E">});</span></li></ol></pre>
<p>Add a <code>...commonInteract(role),</code> property to <code>sellerInteract</code> and <code>buyerInteract</code>.</p>
<p>Retest.</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1">You cancelled the order.</li></ol></pre>
<h1 id="complete-the-transaction">Complete the transaction</h1>
<h2 id="modify-frontend-common-interact">Modify frontend common interact</h2>
<pre class="snippet numbered"><ol class="snippet"><li value="1">const commonInteract = (who) =&gt; ({</li><li value="2">  reportPayment: (payment) =&gt; console.log(`${who == 'buyer' ? 'You' : 'The buyer'} paid ${toSU(payment)} ${suStr} to the contract.`),</li><li value="3">  reportTransfer: (payment) =&gt; console.log(`The contract paid ${toSU(payment)} ${suStr} to ${who == 'seller' ? 'you' : 'the seller'}.`),</li><li value="4">  reportCancellation: () =&gt; { console.log(`${who == 'buyer' ? 'You' : 'The buyer'} cancelled the order.`); }</li><li value="5">});</li></ol></pre>
<h2 id="modify-backend-common-interact">Modify backend common interact</h2>
<pre class="snippet numbered"><ol class="snippet"><li value="1">const commonInteract = {</li><li value="2">  reportPayment: Fun([UInt], Null),</li><li value="3">  reportTransfer: Fun([UInt], Null),</li><li value="4">  reportCancellation: Fun([], Null)</li><li value="5">};</li></ol></pre>
<h2 id="add-pay-and-transfer-steps">Add pay and transfer steps</h2>
<pre class="snippet numbered"><ol class="snippet"><li value="1">B.pay(price);</li><li value="2">each([S, B], () =&gt; interact.reportPayment(price));</li><li value="3">commit();</li><li value="4"></li><li value="5">S.only(() =&gt; { const wisdom = declassify(interact.wisdom); });</li><li value="6">S.publish(wisdom);</li><li value="7">transfer(price).to(S);</li><li value="8">commit();</li><li value="9"></li><li value="10">each([S, B], () =&gt; interact.reportTransfer(price));</li><li value="11">B.interact.reportWisdom(wisdom);</li></ol></pre>
<h2 id="test-pay-and-transfer-steps">Test pay and transfer steps</h2>