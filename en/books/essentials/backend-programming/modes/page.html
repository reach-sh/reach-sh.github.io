<p>Reach programs are organized into four modes:</p>
<ol>
  <li><a href="#initialization">Initialization</a> defines Participants, Views, and APIs, and, optionally, overrides default compilation settings.</li>
  <li><a href="#step">Step</a> defines actions taken by all participants.</li>
  <li><a href="#local-step">Local Step</a> defines actions taken by a particular participant.</li>
  <li><a href="#consensus-step">Consensus Step</a> defines actions taken by the contract.</li>
</ol>
<h2 id="transitions">Transitions</h2>
<p>The following diagram indicates mode transitions:</p>
<div>
  <img src="/en/books/essentials/backend-programming/modes/mode-transitions.png" class="img-fluid" width="500" height="390" loading="lazy">
</div>
<h2 id="consensus-transfers">Consensus Transfers</h2>
<p>A consensus transfer is a statement or expression that (a) facilitates agreement among participants, (b) transitions to a consensus step, and (3) records the agreement as a transaction on the distributed ledger (i.e. blockchain) of the consensus network. These actions include <code>publish</code>, <code>pay</code>, <code>race</code>, <code>fork</code>, and <code>parallelReduce</code>. The developer chooses which consensus transfer to use depending on the number of participants, tasks, and iterations:</p>
<table>
  <thead>
    <tr>
      <th># Participants</th>
      <th># Tasks</th>
      <th># Iterations</th>
      <th>Consensus Transfer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>One</td>
      <td>One</td>
      <td>One</td>
      <td><code>publish</code> or <code>pay</code></td>
    </tr>
    <tr>
      <td>Many</td>
      <td>One</td>
      <td>One</td>
      <td><code>race</code></td>
    </tr>
    <tr>
      <td>Many</td>
      <td>Many</td>
      <td>One</td>
      <td><code>fork</code></td>
    </tr>
    <tr>
      <td>Many</td>
      <td>Many</td>
      <td>Many</td>
      <td><code>parallelReduce</code></td>
    </tr>
  </tbody>
</table>
<p>The following list describes when to use each type of consensus transfer:</p>
<ul>
  <li>Use <code>publish</code> to cause one participant to make a value (e.g. the price of an item) available to all other participants.</li>
  <li>Use <code>pay</code> to cause one participant to pay an amount to the contract account.</li>
  <li>Use <code>race</code> when multiple participants are racing to <code>publish</code> or <code>pay</code>.</li>
  <li>Use <code>fork</code> when multiple participants are racing to do different actions.</li>
  <li>Use <code>parallelReduce</code> when muliple participants are iteratively racing or forking.</li>
</ul>
<p><code>commit</code> transitions from a consensus step to a step.</p>
<h2 id="computations">Computations</h2>
<p>All four modes support a range of statements and expressions described in <a href="/en/books/essentials/backend-programming/computations/">Computations</a>. Each mode supports the additional statements/expressions as described below.</p>
<h1 id="initialization">Initialization</h1>
<p>The Reach compiler recognizes <code>export const main = Reach.App(() =&gt; {}</code> as a Reach DApp, and the body of <code>Reach.App</code> represents Application Initialization mode:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">main</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Reach.</span><span style="color: #6F42C1">App</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #6F42C1">setOptions</span><span style="color: #24292E">({ verifyArithmetic: </span><span style="color: #005CC5">true</span><span style="color: #24292E">, connectors: [</span><span style="color: #005CC5">ETH</span><span style="color: #24292E">, </span><span style="color: #005CC5">ALGO</span><span style="color: #24292E"> ] });</span></li><li value="3"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">S</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Seller'</span><span style="color: #24292E">, sellerInteract);</span></li><li value="4"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">B</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Buyer'</span><span style="color: #24292E">, buyerInteract);</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">V</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">View</span><span style="color: #24292E">(</span><span style="color: #032F62">'Main'</span><span style="color: #24292E">, { price: UInt });</span></li><li value="6"><span style="color: #24292E">  </span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">();</span></li></ol></pre>
<ul>
  <li>Line 1: <code>Reach.App</code> accepts a no-argument function that specifies a DApp.</li>
  <li>Line 2: Optionally, <code>setOptions</code> overrides default compile options.</li>
  <li>Line 3-4: <code>Participant</code> specifies DApp participants.</li>
  <li>Line 5: <code>View</code> specifies DApp views.</li>
  <li>Line 6: The <code>deploy</code> function transitions from Initialization mode to Step mode.</li>
</ul>
<p>In addition to the statements and expressions described in <a href="/en/books/essentials/backend-programming/computations/">Computations</a>, Initialization mode supports the following statements/expressions:</p>
<h2 id="api">API</h2>
<p>An <code>API</code> expression defines an API in the contract.</p>
<h3 id="declaration">Declaration</h3>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #6F42C1">API</span><span style="color: #24292E">(name, interface)</span></li><li value="2"><span style="color: #6A737D">// or </span></li><li value="3"><span style="color: #6F42C1">API</span><span style="color: #24292E">(interface)</span></li></ol></pre>
<ul>
  <li><code>name</code> is a string that labels the API.</li>
  <li><code>interface</code> is an object where each field indicates the type of a function provided by the contract as an API. These APIs are available in frontends via the <code>ctc.apis</code> object. The value returned by this function is an object where the fields are the members of <code>interface</code>. The object may be used in the <code>.api</code> components of <code>fork</code> and <code>parallelReduce</code> expressions. Each object method must occur exactly once in the entire program.</li>
</ul>
<h3 id="example">Example</h3>
<p>See <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/api-full/index.rsh">examples/api-full/index.rsh</a>.</p>
<h2 id="deploy">deploy</h2>
<p>The <code>deploy</code> statement defines Participants, Views, APIs, and compiler options, and transitions from Initialization mode to Step mode.</p>
<h3 id="declaration-1">Declaration</h3>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #6F42C1">deploy</span><span style="color: #24292E">();</span></li></ol></pre>
<h2 id="participant">Participant</h2>
<p>A <code>Participant</code> expression defines a participant.</p>
<h3 id="declaration-2">Declaration</h3>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(name, interface)</span></li></ol></pre>
<ul>
  <li><code>name</code> is a string indicating the name of the participant function in the generated backend code. Each name must be unique.</li>
  <li><code>interface</code> is a participant interact interface, an object where each field indicates the type of a function or value which must be provided to the backend by the frontend for interacting with the participant.</li>
</ul>
<h3 id="example-1">Example</h3>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sellerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  price: UInt,</span></li><li value="3"><span style="color: #24292E">  wisdom: </span><span style="color: #6F42C1">Bytes</span><span style="color: #24292E">(</span><span style="color: #005CC5">128</span><span style="color: #24292E">),</span></li><li value="4"><span style="color: #24292E">  reportReady: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([UInt], Null)</span></li><li value="5"><span style="color: #24292E">};</span></li><li value="6"></li><li value="7"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">S</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Seller'</span><span style="color: #24292E">, sellerInteract);</span></li></ol></pre>
<h2 id="participantclass">ParticipantClass</h2>
<p>A <code>ParticipantClass</code> expression defines a type of participant.</p>
<h3 id="declaration-3">Declaration</h3>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #6F42C1">ParticipantClass</span><span style="color: #24292E">(name, interface)</span></li></ol></pre>
<ul>
  <li><code>name</code> is a string which indicates the name of the participant class function in the generated backend code. Each name must be unique.</li>
  <li><code>interface</code> is a participant class interact interface, an object where each field indicates the type of a function or value which must be provided to the backend by the frontend for interacting with the participants.</li>
</ul>
<h3 id="example-2">Example</h3>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sponsorApi</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  donation: UInt,</span></li><li value="3"><span style="color: #24292E">  reportDonation: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([Address, UInt, UInt, UInt, UInt], Null),</span></li><li value="4"><span style="color: #24292E">};</span></li><li value="5"></li><li value="6"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">S</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ParticipantClass</span><span style="color: #24292E">(</span><span style="color: #032F62">'Sponsor'</span><span style="color: #24292E">, sponsorApi);</span></li></ol></pre>
<h2 id="setoptions">setOptions</h2>
<p>The <code>setOptions</code> statement overrides default application parameters.</p>
<h3 id="declaration-4">Declaration</h3>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #6F42C1">setOptions</span><span style="color: #24292E">(options)</span></li></ol></pre>
<ul>
  <li><code>options</code> is an object containing options and values</li>
</ul>
<p>The options object supports the following key:value pairs:</p>
<table>
  <thead>
    <tr>
      <th>Option</th>
      <th>Type</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>connectors</code></td>
      <td><code>Array</code></td>
      <td>All available connectors</td>
    </tr>
    <tr>
      <td><code>verifyArithmetic</code></td>
      <td><code>Boolean</code></td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>verifyPerConnector</code></td>
      <td><code>Boolean</code></td>
      <td><code>false</code></td>
    </tr>
  </tbody>
</table>
<p><code>connectors</code> is an array of tuples indicating for which consensus networks the compiler will generate contract bytecode.</p>
<p><code>verifyArithmetic</code> is a boolean value indicating whether arithmetic operations introduce static assertions that they do not overflow beyond UInt.max. This defaults to false because it is onerous to verify. We recommend turning it on before final deployment, but leaving it off during development. When it is false, connectors will ensure that overflows do not actually occur on the network.</p>
<p><code>verifyPerConnector</code> is a boolean value that determines whether verification is done per connector, or once for a generic connector. When this is true, then connector-specific constants, like UInt.max, will be instantiated to literal numbers. This concretization of these constants can induce performance degradation in the verifier.</p>
<h3 id="example-3">Example</h3>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #6F42C1">setOptions</span><span style="color: #24292E">({ verifyArithmetic: </span><span style="color: #005CC5">true</span><span style="color: #24292E">, connectors: [</span><span style="color: #005CC5">ETH</span><span style="color: #24292E">, </span><span style="color: #005CC5">ALGO</span><span style="color: #24292E"> ] });</span></li></ol></pre>
<h2 id="view">View</h2>
<p>A View expression defines a view object that allows non-participants to see public variables in the contract.</p>
<h3 id="declaration-5">Declaration</h3>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #6F42C1">View</span><span style="color: #24292E">(name, viewInterface)</span></li><li value="2"><span style="color: #6A737D">// or</span></li><li value="3"><span style="color: #6F42C1">View</span><span style="color: #24292E">(viewInterface)</span></li></ol></pre>
<ul>
  <li><code>name</code> is a string that labels the view.</li>
  <li><code>interface</code> is an object where each field indicates the type of a function or value provided by the contract associated with the specified DApp. These views are available in frontends via the <code>ctc.views</code> object. In the DApp, the result of this argument is referred to as a <code>view</code> object.</li>
</ul>
<h3 id="example-4">Example</h3>
<p>The program instantiates the view in Line 4 and initializes the <code>price</code> property in Line 10:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">main</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Reach.</span><span style="color: #6F42C1">App</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">S</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Seller'</span><span style="color: #24292E">, sellerInteract);</span></li><li value="3"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">B</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Buyer'</span><span style="color: #24292E">, buyerInteract);</span></li><li value="4"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">V</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">View</span><span style="color: #24292E">(</span><span style="color: #032F62">'Main'</span><span style="color: #24292E">, { price: UInt });</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">();</span></li><li value="6"></li><li value="7"><span style="color: #24292E">  </span><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">only</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">price</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">declassify</span><span style="color: #24292E">(interact.price); });</span></li><li value="8"><span style="color: #24292E">  </span><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">(price);</span></li><li value="9"><span style="color: #24292E">  </span><span style="color: #005CC5">S</span><span style="color: #24292E">.interact.</span><span style="color: #6F42C1">reportReady</span><span style="color: #24292E">(price);</span></li><li value="10"><span style="color: #24292E">  </span><span style="color: #005CC5">V</span><span style="color: #24292E">.price.</span><span style="color: #6F42C1">set</span><span style="color: #24292E">(price);</span></li><li value="11"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li></ol></pre>
<h1 id="step">Step</h1>
<p>A <em>Step</em> includes actions that apply to all participants. In addition to the statements and expressions described in <a href="/en/books/essentials/backend-programming/computations/">Computations</a>, Step mode supports the following statements/expressions:</p>
<h2 id="call">call</h2>
<p>The <code>call</code> expression calls the specified API function, returns a pair <code>[DOMAIN, RET_FUN]</code>, and publishes the domain of the API member function.</p>
<h3 id="declaration-6">Declaration</h3>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> [ </span><span style="color: #005CC5">DOMAIN</span><span style="color: #24292E">, </span><span style="color: #005CC5">RET_FUN</span><span style="color: #24292E"> ] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">call</span><span style="color: #24292E">(</span><span style="color: #005CC5">API_EXPR</span><span style="color: #24292E">)</span></li><li value="2"><span style="color: #24292E">  .</span><span style="color: #6F42C1">pay</span><span style="color: #24292E">(</span><span style="color: #005CC5">API_PAY_EXPR</span><span style="color: #24292E">)</span></li><li value="3"><span style="color: #24292E">  .</span><span style="color: #6F42C1">assume</span><span style="color: #24292E">(</span><span style="color: #005CC5">API_ASSUME_EXPR</span><span style="color: #24292E">)</span></li><li value="4"><span style="color: #24292E">  .</span><span style="color: #6F42C1">throwTimeout</span><span style="color: #24292E">(</span><span style="color: #005CC5">DELAY_EXPR</span><span style="color: #24292E">, </span><span style="color: #005CC5">THROW_EXPR</span><span style="color: #24292E">)</span></li></ol></pre>
<ul>
  <li><code>DOMAIN</code> is the domain of the API member function.</li>
  <li><code>RET_FUN</code> is a function that returns a value to the API call. This function must be called.</li>
  <li><code>API_EXPR</code> is an expression that evaluates to an API member function.</li>
  <li><code>API_PAY_EXPR</code>, <code>API_ASSUME_EXPR</code>, and <code>throwTimeout</code> are optional. See <a href="#fork">Fork</a>.</li>
</ul>
<h3 id="example-5">Example</h3>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">A</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">API</span><span style="color: #24292E">(</span><span style="color: #032F62">'A'</span><span style="color: #24292E">, { isGt: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([UInt, UInt], Bool); });</span></li><li value="2"><span style="color: #6A737D">// ...</span></li><li value="3"><span style="color: #D73A49">const</span><span style="color: #24292E"> [ </span><span style="color: #005CC5">dom</span><span style="color: #24292E">, </span><span style="color: #005CC5">k</span><span style="color: #24292E"> ] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">call</span><span style="color: #24292E">(</span><span style="color: #005CC5">A</span><span style="color: #24292E">.isGt).</span><span style="color: #6F42C1">assume</span><span style="color: #24292E">((</span><span style="color: #E36209">x</span><span style="color: #24292E">, </span><span style="color: #E36209">y</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> x </span><span style="color: #D73A49">!=</span><span style="color: #24292E"> y).</span><span style="color: #6F42C1">pay</span><span style="color: #24292E">((</span><span style="color: #E36209">x</span><span style="color: #24292E">, </span><span style="color: #E36209">y</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> x);</span></li><li value="4"><span style="color: #D73A49">const</span><span style="color: #24292E"> [</span><span style="color: #005CC5">x</span><span style="color: #24292E">, </span><span style="color: #005CC5">y</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> dom;</span></li><li value="5"><span style="color: #6F42C1">k</span><span style="color: #24292E">(x </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> y);</span></li><li value="6"><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li></ol></pre>
<h2 id="closeto">closeTo</h2>
<p>The <code>closeTo</code> expression causes the specified participant to publish, receive a <code>transfer</code> of the contract balance and the <a href="/en/books/essentials/terminology/#pay-amount">pay amount</a>, and then exit.</p>
<h3 id="declaration-7">Declaration</h3>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #6F42C1">closeTo</span><span style="color: #24292E">( Who, after, nonNetPayAmt )</span></li></ol></pre>
<ul>
  <li><code>Who</code> is the participant.</li>
  <li><code>after</code> is a no-argument function called before exit. It is optional.</li>
  <li><code>nonNetPayAmt</code>. See <a href="/en/books/essentials/terminology/#pay-amount">Pay Amount</a>. It is optional.</li>
</ul>
<h3 id="example-6">Example</h3>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">aliceInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  informTimeout: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([], Null)</span></li><li value="3"><span style="color: #24292E">};</span></li><li value="4"></li><li value="5"><span style="color: #005CC5">B</span><span style="color: #24292E">.</span><span style="color: #6F42C1">pay</span><span style="color: #24292E">(wager).</span><span style="color: #6F42C1">timeout</span><span style="color: #24292E">(</span><span style="color: #005CC5">DEADLINE</span><span style="color: #24292E">, () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">closeTo</span><span style="color: #24292E">(</span><span style="color: #005CC5">A</span><span style="color: #24292E">, informTimeout));</span></li></ol></pre>
<h2 id="exit">exit</h2>
<h3 id="declaration-8">Declaration</h3>
<h3 id="example-7">Example</h3>
<h2 id="fork">fork</h2>
<h3 id="declaration-9">Declaration</h3>
<h3 id="example-8">Example</h3>
<h2 id="each-and-only">each and only</h2>
<h3 id="declaration-10">Declaration</h3>
<h3 id="example-9">Example</h3>
<h2 id="publish-pay-when-timeout">publish, pay, when, timeout</h2>
<h3 id="declaration-11">Declaration</h3>
<h3 id="example-10">Example</h3>
<h2 id="race">race</h2>
<h3 id="declaration-12">Declaration</h3>
<h3 id="example-11">Example</h3>
<h2 id="unknowable">unknowable</h2>
<h3 id="declaration-13">Declaration</h3>
<h3 id="example-12">Example</h3>
<h2 id="wait">wait</h2>
<h3 id="declaration-14">Declaration</h3>
<h3 id="example-13">Example</h3>
<h1 id="local-step">Local Step</h1>
<p>A <em>Local Step</em> occurs in the body of <a href="#each-and-only">each and only</a> statements. It represents the actions taken by a single participant in an application. Inside a local step, <code>this</code> refers to the participant performing the step, useful when the local step was initiated by an <code>each</code> expression. In addition to the statements and expressions described in <a href="/en/books/essentials/backend-programming/computations/">Computations</a>, Local Step mode supports the following statements/expressions:</p>
<h2 id="assume">assume</h2>
<h3 id="declaration-15">Declaration</h3>
<h3 id="example-14">Example</h3>
<h2 id="declassify">declassify</h2>
<h3 id="declaration-16">Declaration</h3>
<h3 id="example-15">Example</h3>
<h2 id="didpublish">didPublish</h2>
<h3 id="declaration-17">Declaration</h3>
<h3 id="example-16">Example</h3>
<h2 id="fail">fail</h2>
<h3 id="declaration-18">Declaration</h3>
<h3 id="example-17">Example</h3>
<h2 id="interact">interact</h2>
<h3 id="declaration-19">Declaration</h3>
<h3 id="example-18">Example</h3>
<h2 id="makecommitment">makeCommitment</h2>
<h3 id="declaration-20">Declaration</h3>
<h3 id="example-19">Example</h3>
<h1 id="consensus-step">Consensus Step</h1>
<p>A <em>Consensus Step</em> occurs in the continuation of a consensus transfer statement. It represents the actions taken by the consensus network contract of an application. Inside of a consensus step, <code>this</code> refers to the address of the participant that performed the consensus transfer. This is useful when the consensus transfer was initiated by a race expression. In addition to the statements and expressions described in <a href="/en/books/essentials/backend-programming/computations/">Computations</a>, Consensus Step mode supports the following statements/expressions:</p>
<h2 id="checkcommitment">checkCommitment</h2>
<h3 id="declaration-21">Declaration</h3>
<h3 id="example-20">Example</h3>
<h2 id="commit">commit</h2>
<h3 id="declaration-22">Declaration</h3>
<h3 id="example-21">Example</h3>
<h2 id="continue">continue</h2>
<h3 id="declaration-23">Declaration</h3>
<h3 id="example-22">Example</h3>
<h2 id="each-and-only-consensus">each and only (consensus)</h2>
<p><a href="#each-and-only">each and only</a> are allowed in consensus steps and are executed by backends once they observe the completion of the consensus step (i.e., after the associated commit statement.)</p>
<h2 id="map">Map</h2>
<h3 id="declaration-24">Declaration</h3>
<h3 id="example-23">Example</h3>
<h2 id="parallelreduce">parallelReduce</h2>
<h3 id="declaration-25">Declaration</h3>
<h3 id="example-24">Example</h3>
<h2 id="remote">remote</h2>
<h3 id="declaration-26">Declaration</h3>
<h3 id="example-25">Example</h3>
<h2 id="require">require</h2>
<h3 id="declaration-27">Declaration</h3>
<h3 id="example-26">Example</h3>
<h2 id="set">Set</h2>
<h3 id="declaration-28">Declaration</h3>
<h3 id="example-27">Example</h3>
<h2 id="throughtimeout">.throughTimeout</h2>
<h3 id="declaration-29">Declaration</h3>
<h3 id="example-28">Example</h3>
<h2 id="timeremaining">.timeRemaining</h2>
<h3 id="declaration-30">Declaration</h3>
<h3 id="example-29">Example</h3>
<h2 id="token">Token</h2>
<p>The <code>Token</code> expression mints a new non-network token.</p>
<h3 id="declaration-31">Declaration</h3>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Token</span><span style="color: #24292E">(</span><span style="color: #005CC5">PARAMS</span><span style="color: #24292E">)</span></li></ol></pre>
<ul>
  <li>
    <p><code>PARAMS</code> is an object with the keys in the table below.</p>
    <table>
      <thead>
        <tr>
          <th>Key</th>
          <th>Type</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>name</code></td>
          <td><code>Bytes(32)</code></td>
          <td>empty</td>
        </tr>
        <tr>
          <td><code>symbol</code></td>
          <td><code>Bytes(8)</code></td>
          <td>empty</td>
        </tr>
        <tr>
          <td><code>url</code></td>
          <td><code>Bytes(96)</code></td>
          <td>empty</td>
        </tr>
        <tr>
          <td><code>metadata</code></td>
          <td><code>Bytes(32)</code></td>
          <td>empty</td>
        </tr>
        <tr>
          <td><code>supply</code></td>
          <td><code>UInt</code></td>
          <td><code>UInt.max</code></td>
        </tr>
        <tr>
          <td><code>decimals</code></td>
          <td><code>UInt</code></td>
          <td>ALGO = 6; CFX and ETH = 18</td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>
<p>This returns a Token value and deposits a supply amount of the new non-network tokens into the contract account associated with the DApp. These tokens must be destroyed by the end of the DApp. A token has the following methods:</p>
<ul>
  <li>
    <p><code>Token.burn(tok, amt)</code> or <code>tok.burn(amt)</code>, where tok is a Token value and amt is a UInt value, may be used to burn tokens in the contract account, meaning that they are utterly destroyed and can never be recovered.</p>
  </li>
  <li>
    <p><code>Token.destroy(tok)</code> or <code>tok.destroy()</code>, where tok is a Token value, may be used to destroy the token so that it may never be used again by any users on the consensus network. This must be called before the application exits.</p>
  </li>
  <li>
    <p><code>Token.destroyed(tok)</code> or <code>tok.destroyed()</code>, where tok is a Token value, returns whether destroy has been called on tok yet.</p>
  </li>
  <li>
    <p><code>Token.supply(tok)</code> or <code>tok.supply()</code>, where tok is a Token value, may be used to query the current supply of tokens, i.e. the number of tokens which have not been burnt.</p>
  </li>
</ul>
<h3 id="example-30">Example</h3>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #005CC5">require</span><span style="color: #24292E">(supply </span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E"> amt);</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">tok</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Token</span><span style="color: #24292E">({ name, symbol, url, metadata, supply, decimals });</span></li><li value="3"><span style="color: #6F42C1">transfer</span><span style="color: #24292E">(amt, tok).</span><span style="color: #6F42C1">to</span><span style="color: #24292E">(who);</span></li><li value="4"><span style="color: #24292E">tok.</span><span style="color: #6F42C1">burn</span><span style="color: #24292E">(amt);</span></li><li value="5"><span style="color: #6F42C1">assert</span><span style="color: #24292E">(tok.</span><span style="color: #6F42C1">supply</span><span style="color: #24292E">() </span><span style="color: #D73A49">==</span><span style="color: #24292E"> supply </span><span style="color: #D73A49">-</span><span style="color: #24292E"> amt);</span></li><li value="6"><span style="color: #24292E">tok.</span><span style="color: #6F42C1">burn</span><span style="color: #24292E">();</span></li><li value="7"><span style="color: #6F42C1">assert</span><span style="color: #24292E">(tok.</span><span style="color: #6F42C1">destroyed</span><span style="color: #24292E">() </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">);</span></li><li value="8"><span style="color: #24292E">tok.</span><span style="color: #6F42C1">destroy</span><span style="color: #24292E">();</span></li></ol></pre>
<h2 id="transfer">transfer</h2>
<p>A <code>transfer</code> expression transfers the specified number of tokens from the contract account to the specified participant account.</p>
<h3 id="declaration-32">Declaration</h3>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #6F42C1">transfer</span><span style="color: #24292E">(</span><span style="color: #005CC5">AMOUNT_EXPR</span><span style="color: #24292E">).</span><span style="color: #6F42C1">to</span><span style="color: #24292E">(</span><span style="color: #005CC5">ADDR_EXPR</span><span style="color: #24292E">)</span></li><li value="2"><span style="color: #6A737D">// or</span></li><li value="3"><span style="color: #6F42C1">transfer</span><span style="color: #24292E">(</span><span style="color: #005CC5">AMOUNT_EXPR</span><span style="color: #24292E">, </span><span style="color: #005CC5">TOKEN_EXPR</span><span style="color: #24292E">).</span><span style="color: #6F42C1">to</span><span style="color: #24292E">(</span><span style="color: #005CC5">ADDR_EXPR</span><span style="color: #24292E">)</span></li></ol></pre>
<ul>
  <li><code>AMOUNT_EXPR</code> is an unsigned integer specifying the number of tokens to transfer from the contract. This amount must evaluate to less than or equal to the balance of network tokens in the contract account.</li>
  <li><code>ADDR_EXPR</code> is the target address for the transfer.</li>
  <li><code>TOKEN_EXPR</code> is a Token type. This argument is optional.</li>
</ul>
<h3 id="example-31">Example</h3>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #6F42C1">transfer</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">).</span><span style="color: #6F42C1">to</span><span style="color: #24292E">(Alice);</span></li></ol></pre>
<h2 id="while">while</h2>
<p>A <code>while</code> statement loops until the specified condition is <code>false</code>.</p>
<h3 id="declaration-33">Declaration</h3>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #005CC5">LHS</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">INIT_EXPR</span><span style="color: #24292E">;</span></li><li value="2"><span style="color: #005CC5">DEFINE_BLOCK</span><span style="color: #24292E">; </span><span style="color: #6A737D">// optional</span></li><li value="3"><span style="color: #6F42C1">invariant</span><span style="color: #24292E">(</span><span style="color: #005CC5">INVARIANT_EXPR</span><span style="color: #24292E">);</span></li><li value="4"><span style="color: #D73A49">while</span><span style="color: #24292E">( </span><span style="color: #005CC5">COND_EXPR</span><span style="color: #24292E"> ) </span><span style="color: #005CC5">BLOCK</span></li></ol></pre>
<ul>
  <li><code>LHS</code> is a valid left-hand side of an identifier definition where the expression INIT_EXPR is the right-hand side.</li>
  <li><code>DEFINE_BLOCK</code> is an optional block that may define bindings that use the LHS values which are bound inside the rest of the while and its tail.</li>
  <li><code>INVARIANT_EXPR</code> is an expression, called the loop invariant, that must be true before and after every execution of the block BLOCK</li>
  <li><code>COND_EXPR</code> is the condition. While it is true the block executes. When it is false the loop terminates and control transfers to the continuation of the while statement. The identifiers bound by <code>LHS</code> are bound within <code>DEFINE_BLOCK</code>, <code>INVARIANT_EXPR</code>, <code>COND_EXPR</code>, <code>BLOCK</code>, and the tail of the while statement.</li>
</ul>
<h3 id="example-32">Example</h3>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">var</span><span style="color: #24292E"> [ heap1, heap2 ] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [ </span><span style="color: #005CC5">21</span><span style="color: #24292E">, </span><span style="color: #005CC5">21</span><span style="color: #24292E"> ];</span></li><li value="2"><span style="color: #24292E">{ </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sum</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> heap1 </span><span style="color: #D73A49">+</span><span style="color: #24292E"> heap2; }</span></li><li value="3"><span style="color: #6F42C1">invariant</span><span style="color: #24292E">(</span><span style="color: #6F42C1">balance</span><span style="color: #24292E">() </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E"> wagerAmount);</span></li><li value="4"><span style="color: #D73A49">while</span><span style="color: #24292E"> ( </span><span style="color: #6F42C1">sum</span><span style="color: #24292E">() </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E"> ) {</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #D73A49">...</span><span style="color: #24292E">.</span></li><li value="6"><span style="color: #24292E">  [ heap1, heap2 ] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [ heap1 </span><span style="color: #D73A49">-</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">, heap2 ];</span></li><li value="7"><span style="color: #24292E">  </span><span style="color: #D73A49">continue</span><span style="color: #24292E">; }</span></li></ol></pre>